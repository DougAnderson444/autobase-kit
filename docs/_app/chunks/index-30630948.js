var Cs=Object.defineProperty,Rs=Object.defineProperties;var Ts=Object.getOwnPropertyDescriptors;var st=Object.getOwnPropertySymbols;var nr=Object.prototype.hasOwnProperty,rr=Object.prototype.propertyIsEnumerable;var ir=(n,e,t)=>e in n?Cs(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,R=(n,e)=>{for(var t in e||(e={}))nr.call(e,t)&&ir(n,t,e[t]);if(st)for(var t of st(e))rr.call(e,t)&&ir(n,t,e[t]);return n},q=(n,e)=>Rs(n,Ts(e));var te=(n,e)=>{var t={};for(var r in n)nr.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&st)for(var r of st(n))e.indexOf(r)<0&&rr.call(n,r)&&(t[r]=n[r]);return t};import{e as ge,i as xe}from"./inherits_browser-5be4ea89.js";import{_ as Ps}from"./__vite-browser-external-a3652709.js";import{b as Fe}from"./index-2028a267.js";function Os(n,e){return e.forEach(function(t){t&&typeof t!="string"&&!Array.isArray(t)&&Object.keys(t).forEach(function(r){if(r!=="default"&&!(r in n)){var i=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(n,r,i.get?i:{enumerable:!0,get:function(){return t[r]}})}})}),Object.freeze(n)}var N=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};function sr(n){if(n.__esModule)return n;var e=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(n).forEach(function(t){var r=Object.getOwnPropertyDescriptor(n,t);Object.defineProperty(e,t,r.get?r:{enumerable:!0,get:function(){return n[t]}})}),e}var ot={exports:{}},G=sr(Ps),me=ar;class or extends Error{}or.prototype.name="AssertionError";function ar(n,e,...t){if(!n){var r;throw(!e||typeof e=="string")&&(r=new or(e)),typeof e=="function"&&(r=new e(...t)),Error.captureStackTrace&&Error.captureStackTrace(r,ar),r}}var at={exports:{}},As=cr;function cr(n,e){if(n&&e)return cr(n)(e);if(typeof n!="function")throw new TypeError("need wrapper function");return Object.keys(n).forEach(function(r){t[r]=n[r]}),t;function t(){for(var r=new Array(arguments.length),i=0;i<r.length;i++)r[i]=arguments[i];var s=n.apply(this,r),o=r[r.length-1];return typeof s=="function"&&s!==o&&Object.keys(o).forEach(function(c){s[c]=o[c]}),s}}var lr=As;at.exports=lr(ct);at.exports.strict=lr(ur);ct.proto=ct(function(){Object.defineProperty(Function.prototype,"once",{value:function(){return ct(this)},configurable:!0}),Object.defineProperty(Function.prototype,"onceStrict",{value:function(){return ur(this)},configurable:!0})});function ct(n){var e=function(){return e.called?e.value:(e.called=!0,e.value=n.apply(this,arguments))};return e.called=!1,e}function ur(n){var e=function(){if(e.called)throw new Error(e.onceError);return e.called=!0,e.value=n.apply(this,arguments)},t=n.name||"Function wrapped with `once`";return e.onceError=t+" shouldn't be called more than once",e.called=!1,e}var ks=at.exports,Ns=function(){},Ls=function(n){return n.setHeader&&typeof n.abort=="function"},Ms=function(n){return n.stdio&&Array.isArray(n.stdio)&&n.stdio.length===3},hr=function(n,e,t){if(typeof e=="function")return hr(n,null,e);e||(e={}),t=ks(t||Ns);var r=n._writableState,i=n._readableState,s=e.readable||e.readable!==!1&&n.readable,o=e.writable||e.writable!==!1&&n.writable,c=!1,a=function(){n.writable||u()},u=function(){o=!1,s||t.call(n)},l=function(){s=!1,o||t.call(n)},h=function(p){t.call(n,p?new Error("exited with error code: "+p):null)},f=function(p){t.call(n,p)},_=function(){process.nextTick(d)},d=function(){if(!c){if(s&&!(i&&i.ended&&!i.destroyed))return t.call(n,new Error("premature close"));if(o&&!(r&&r.ended&&!r.destroyed))return t.call(n,new Error("premature close"))}},m=function(){n.req.on("finish",u)};return Ls(n)?(n.on("complete",u),n.on("abort",_),n.req?m():n.on("request",m)):o&&!r&&(n.on("end",a),n.on("close",a)),Ms(n)&&n.on("exit",h),n.on("end",l),n.on("finish",u),e.error!==!1&&n.on("error",f),n.on("close",_),function(){c=!0,n.removeListener("complete",u),n.removeListener("abort",_),n.removeListener("request",m),n.req&&n.req.removeListener("finish",u),n.removeListener("end",a),n.removeListener("close",a),n.removeListener("finish",u),n.removeListener("exit",h),n.removeListener("end",l),n.removeListener("error",f),n.removeListener("close",_)}},lt=hr,Is=at.exports,Ds=lt,Vt=G,qe=function(){},xs=/^v?\.0/.test(process.version),ut=function(n){return typeof n=="function"},Fs=function(n){return!xs||!Vt?!1:(n instanceof(Vt.ReadStream||qe)||n instanceof(Vt.WriteStream||qe))&&ut(n.close)},qs=function(n){return n.setHeader&&ut(n.abort)},js=function(n,e,t,r){r=Is(r);var i=!1;n.on("close",function(){i=!0}),Ds(n,{readable:e,writable:t},function(o){if(o)return r(o);i=!0,r()});var s=!1;return function(o){if(!i&&!s){if(s=!0,Fs(n))return n.close(qe);if(qs(n))return n.abort();if(ut(n.destroy))return n.destroy();r(o||new Error("stream was destroyed"))}}},fr=function(n){n()},$s=function(n,e){return n.pipe(e)},Bs=function(){var n=Array.prototype.slice.call(arguments),e=ut(n[n.length-1]||qe)&&n.pop()||qe;if(Array.isArray(n[0])&&(n=n[0]),n.length<2)throw new Error("pump requires two streams per minimum");var t,r=n.map(function(i,s){var o=s<n.length-1,c=s>0;return js(i,o,c,function(a){t||(t=a),a&&r.forEach(fr),!o&&(r.forEach(fr),e(t))})});return n.reduce($s)},Us=Bs,j={exports:{}},ye=1e3,be=ye*60,ve=be*60,ne=ve*24,Ws=ne*7,Hs=ne*365.25,Gs=function(n,e){e=e||{};var t=typeof n;if(t==="string"&&n.length>0)return Vs(n);if(t==="number"&&isFinite(n))return e.long?Qs(n):zs(n);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(n))};function Vs(n){if(n=String(n),!(n.length>100)){var e=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(n);if(!!e){var t=parseFloat(e[1]),r=(e[2]||"ms").toLowerCase();switch(r){case"years":case"year":case"yrs":case"yr":case"y":return t*Hs;case"weeks":case"week":case"w":return t*Ws;case"days":case"day":case"d":return t*ne;case"hours":case"hour":case"hrs":case"hr":case"h":return t*ve;case"minutes":case"minute":case"mins":case"min":case"m":return t*be;case"seconds":case"second":case"secs":case"sec":case"s":return t*ye;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return t;default:return}}}}function zs(n){var e=Math.abs(n);return e>=ne?Math.round(n/ne)+"d":e>=ve?Math.round(n/ve)+"h":e>=be?Math.round(n/be)+"m":e>=ye?Math.round(n/ye)+"s":n+"ms"}function Qs(n){var e=Math.abs(n);return e>=ne?ht(n,e,ne,"day"):e>=ve?ht(n,e,ve,"hour"):e>=be?ht(n,e,be,"minute"):e>=ye?ht(n,e,ye,"second"):n+" ms"}function ht(n,e,t,r){var i=e>=t*1.5;return Math.round(n/t)+" "+r+(i?"s":"")}function Ys(n){t.debug=t,t.default=t,t.coerce=a,t.disable=s,t.enable=i,t.enabled=o,t.humanize=Gs,t.destroy=u,Object.keys(n).forEach(l=>{t[l]=n[l]}),t.names=[],t.skips=[],t.formatters={};function e(l){let h=0;for(let f=0;f<l.length;f++)h=(h<<5)-h+l.charCodeAt(f),h|=0;return t.colors[Math.abs(h)%t.colors.length]}t.selectColor=e;function t(l){let h,f=null,_,d;function m(...p){if(!m.enabled)return;const E=m,O=Number(new Date),g=O-(h||O);E.diff=g,E.prev=h,E.curr=O,h=O,p[0]=t.coerce(p[0]),typeof p[0]!="string"&&p.unshift("%O");let T=0;p[0]=p[0].replace(/%([a-zA-Z%])/g,(P,S)=>{if(P==="%%")return"%";T++;const tr=t.formatters[S];if(typeof tr=="function"){const Ss=p[T];P=tr.call(E,Ss),p.splice(T,1),T--}return P}),t.formatArgs.call(E,p),(E.log||t.log).apply(E,p)}return m.namespace=l,m.useColors=t.useColors(),m.color=t.selectColor(l),m.extend=r,m.destroy=t.destroy,Object.defineProperty(m,"enabled",{enumerable:!0,configurable:!1,get:()=>f!==null?f:(_!==t.namespaces&&(_=t.namespaces,d=t.enabled(l)),d),set:p=>{f=p}}),typeof t.init=="function"&&t.init(m),m}function r(l,h){const f=t(this.namespace+(typeof h=="undefined"?":":h)+l);return f.log=this.log,f}function i(l){t.save(l),t.namespaces=l,t.names=[],t.skips=[];let h;const f=(typeof l=="string"?l:"").split(/[\s,]+/),_=f.length;for(h=0;h<_;h++)!f[h]||(l=f[h].replace(/\*/g,".*?"),l[0]==="-"?t.skips.push(new RegExp("^"+l.substr(1)+"$")):t.names.push(new RegExp("^"+l+"$")))}function s(){const l=[...t.names.map(c),...t.skips.map(c).map(h=>"-"+h)].join(",");return t.enable(""),l}function o(l){if(l[l.length-1]==="*")return!0;let h,f;for(h=0,f=t.skips.length;h<f;h++)if(t.skips[h].test(l))return!1;for(h=0,f=t.names.length;h<f;h++)if(t.names[h].test(l))return!0;return!1}function c(l){return l.toString().substring(2,l.toString().length-2).replace(/\.\*\?$/,"*")}function a(l){return l instanceof Error?l.stack||l.message:l}function u(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return t.enable(t.load()),t}var Ks=Ys;(function(n,e){e.formatArgs=r,e.save=i,e.load=s,e.useColors=t,e.storage=o(),e.destroy=(()=>{let a=!1;return()=>{a||(a=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),e.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function t(){return typeof window!="undefined"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document!="undefined"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window!="undefined"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function r(a){if(a[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+a[0]+(this.useColors?"%c ":" ")+"+"+n.exports.humanize(this.diff),!this.useColors)return;const u="color: "+this.color;a.splice(1,0,u,"color: inherit");let l=0,h=0;a[0].replace(/%[a-zA-Z%]/g,f=>{f!=="%%"&&(l++,f==="%c"&&(h=l))}),a.splice(h,0,u)}e.log=console.debug||console.log||(()=>{});function i(a){try{a?e.storage.setItem("debug",a):e.storage.removeItem("debug")}catch{}}function s(){let a;try{a=e.storage.getItem("debug")}catch{}return!a&&typeof process!="undefined"&&"env"in process&&(a={ALLUSERSPROFILE:"C:\\ProgramData",APPDATA:"C:\\Users\\douga\\AppData\\Roaming",ChocolateyInstall:"C:\\ProgramData\\chocolatey",ChocolateyLastPathUpdate:"132760181786681318",CHROME_CRASHPAD_PIPE_NAME:"\\\\.\\pipe\\crashpad_10864_WWFQYFFZLJDBVAQA",COLOR:"1",COLORTERM:"truecolor",CommonProgramFiles:"C:\\Program Files\\Common Files","CommonProgramFiles(x86)":"C:\\Program Files (x86)\\Common Files",CommonProgramW6432:"C:\\Program Files\\Common Files",COMPUTERNAME:"DESKTOP-DOUGLAS",ComSpec:"C:\\WINDOWS\\system32\\cmd.exe",DriverData:"C:\\Windows\\System32\\Drivers\\DriverData",EDITOR:"notepad.exe",FPS_BROWSER_APP_PROFILE_STRING:"Internet Explorer",FPS_BROWSER_USER_PROFILE_STRING:"Default",GIT_ASKPASS:"c:\\Users\\douga\\AppData\\Local\\Programs\\Microsoft VS Code\\resources\\app\\extensions\\git\\dist\\askpass.sh",HOME:"C:\\Users\\douga",HOMEDRIVE:"C:",HOMEPATH:"\\Users\\douga",INIT_CWD:"C:\\Users\\douga\\Documents2\\code\\autobase-kit",JAVA_HOME:"C:\\Program Files\\Eclipse Adoptium\\jdk-11.0.13.8-hotspot\\",LANG:"en_GB.UTF-8",LOCALAPPDATA:"C:\\Users\\douga\\AppData\\Local",LOGONSERVER:"\\\\DESKTOP-DOUGLAS",NODE:"C:\\Program Files\\nodejs\\node.exe",NODE_ENV:"production",NODE_EXE:"C:\\Program Files\\nodejs\\\\node.exe",NPM_CLI_JS:"C:\\Users\\douga\\AppData\\Roaming\\npm\\node_modules\\npm\\bin\\npm-cli.js",npm_command:"run-script",npm_config_cache:"C:\\Users\\douga\\AppData\\Local\\npm-cache",npm_config_engine_strict:"true",npm_config_globalconfig:"C:\\Users\\douga\\AppData\\Roaming\\npm\\etc\\npmrc",npm_config_global_prefix:"C:\\Users\\douga\\AppData\\Roaming\\npm",npm_config_init_module:"C:\\Users\\douga\\.npm-init.js",npm_config_local_prefix:"C:\\Users\\douga\\Documents2\\code\\autobase-kit",npm_config_metrics_registry:"https://registry.npmjs.org/",npm_config_node_gyp:"C:\\Users\\douga\\AppData\\Roaming\\npm\\node_modules\\npm\\node_modules\\node-gyp\\bin\\node-gyp.js",npm_config_noproxy:"",npm_config_prefix:"C:\\Users\\douga\\AppData\\Roaming\\npm",npm_config_userconfig:"C:\\Users\\douga\\.npmrc",npm_config_user_agent:"npm/8.3.0 node/v16.8.0 win32 x64 workspaces/false",npm_execpath:"C:\\Users\\douga\\AppData\\Roaming\\npm\\node_modules\\npm\\bin\\npm-cli.js",npm_lifecycle_event:"build",npm_lifecycle_script:"svelte-kit build",npm_node_execpath:"C:\\Program Files\\nodejs\\node.exe",npm_package_json:"C:\\Users\\douga\\Documents2\\code\\autobase-kit\\package.json",npm_package_name:"autobase-kit",npm_package_version:"0.0.1",NPM_PREFIX_NPM_CLI_JS:"C:\\Users\\douga\\AppData\\Roaming\\npm\\node_modules\\npm\\bin\\npm-cli.js",NUMBER_OF_PROCESSORS:"4",OneDrive:"C:\\Users\\douga\\OneDrive",OPENSSL_DIR:"C:\\Users\\douga\\Documents2\\code\\vcpkg\\installed\\x64-windows",OPENSSL_INCLUDE_DIR:"C:\\Users\\douga\\Documents2\\code\\vcpkg\\installed\\x64-windows\\\\include",OPENSSL_LIB_DIR:"C:\\Users\\douga\\Documents2\\code\\vcpkg\\installed\\x64-windows\\\\lib",ORIGINAL_XDG_CURRENT_DESKTOP:"undefined",OS:"Windows_NT",Path:"C:\\Users\\douga\\Documents2\\code\\autobase-kit\\node_modules\\.bin;C:\\Users\\douga\\Documents2\\code\\node_modules\\.bin;C:\\Users\\douga\\Documents2\\node_modules\\.bin;C:\\Users\\douga\\node_modules\\.bin;C:\\Users\\node_modules\\.bin;C:\\node_modules\\.bin;C:\\Users\\douga\\AppData\\Roaming\\npm\\node_modules\\npm\\node_modules\\@npmcli\\run-script\\lib\\node-gyp-bin;C:\\Program Files\\Eclipse Adoptium\\jdk-11.0.13.8-hotspot\\bin;C:\\Program Files (x86)\\mingw-w64\\i686-8.1.0-posix-dwarf-rt_v6-rev0\\mingw32\\bin;C:\\Python39\\Scripts\\;C:\\Python39\\;C:\\WINDOWS\\system32;C:\\WINDOWS;C:\\WINDOWS\\System32\\Wbem;C:\\WINDOWS\\System32\\WindowsPowerShell\\v1.0\\;C:\\WINDOWS\\System32\\OpenSSH\\;C:\\ProgramData\\chocolatey\\bin;C:\\Program Files\\Microsoft\\Azure Functions Core Tools\\;C:\\Program Files\\dotnet\\;C:\\Program Files\\Intel\\WiFi\\bin\\;C:\\Program Files\\Common Files\\Intel\\WirelessCommon\\;C:\\Program Files (x86)\\Yarn\\bin\\;C:\\Program Files (x86)\\Windows Kits\\10\\Windows Performance Toolkit\\;C:\\Program Files\\nodejs\\;C:\\Program Files\\Docker\\Docker\\resources\\bin;C:\\Gradle\\gradle-7.3.3\\bin;C:\\Program Files\\Android\\Android Studio\\bin;C:\\Program Files\\Git\\cmd;C:\\Users\\douga\\.local\\share\\solana\\install\\active_release\\bin;C:\\Users\\douga\\.cargo\\bin;C:\\Users\\douga\\AppData\\Local\\Microsoft\\WindowsApps;C:\\Users\\douga\\AppData\\Local\\Programs\\Microsoft VS Code\\bin;C:\\Users\\douga\\.deno\\bin;C:\\Users\\douga\\.dotnet\\tools;C:\\Program Files\\Intel\\WiFi\\bin\\;C:\\Program Files\\Common Files\\Intel\\WirelessCommon\\;C:\\Users\\douga\\AppData\\Local\\Yarn\\bin;C:\\Users\\douga\\AppData\\Local\\Microsoft\\WindowsApps;C:\\Users\\douga\\AppData\\Local\\Programs\\Microsoft VS Code Insiders\\bin;C:\\Users\\douga\\.wry\\bin;C:\\Users\\douga\\Apps\\go-ipfs_v0.8.0\\go-ipfs;C:\\Users\\douga\\.dotnet\\tools;C:\\Users\\douga\\AppData\\Roaming\\npm;C:\\Users\\douga\\.scrt;C:\\Program Files (x86)\\BrowserStackLocal\\;C:\\Users\\douga\\AppData\\Local\\GitHubDesktop\\bin",PATHEXT:".COM;.EXE;.BAT;.CMD;.VBS;.VBE;.JS;.JSE;.WSF;.WSH;.MSC;.PY;.PYW;.CPL",PROCESSOR_ARCHITECTURE:"AMD64",PROCESSOR_IDENTIFIER:"Intel64 Family 6 Model 58 Stepping 9, GenuineIntel",PROCESSOR_LEVEL:"6",PROCESSOR_REVISION:"3a09",ProgramData:"C:\\ProgramData",ProgramFiles:"C:\\Program Files","ProgramFiles(x86)":"C:\\Program Files (x86)",ProgramW6432:"C:\\Program Files",PROMPT:"$P$G",PSModulePath:"C:\\Users\\douga\\Documents\\WindowsPowerShell\\Modules;C:\\Program Files\\WindowsPowerShell\\Modules;C:\\WINDOWS\\system32\\WindowsPowerShell\\v1.0\\Modules",PUBLIC:"C:\\Users\\Public",SESSIONNAME:"Console",SystemDrive:"C:",SystemRoot:"C:\\WINDOWS",TEMP:"C:\\Users\\douga\\AppData\\Local\\Temp",TERM_PROGRAM:"vscode",TERM_PROGRAM_VERSION:"1.64.0",TMP:"C:\\Users\\douga\\AppData\\Local\\Temp",USERDOMAIN:"DESKTOP-DOUGLAS",USERDOMAIN_ROAMINGPROFILE:"DESKTOP-DOUGLAS",USERNAME:"douga",USERPROFILE:"C:\\Users\\douga",VCPKGRS_DYNAMIC:"1",VITE_SVELTEKIT_AMP:"",VITE_SVELTEKIT_APP_VERSION:"1643986563427",VITE_SVELTEKIT_APP_VERSION_FILE:"_app/version.json",VITE_SVELTEKIT_APP_VERSION_POLL_INTERVAL:"0",VS140COMNTOOLS:"C:\\Program Files (x86)\\Microsoft Visual Studio 14.0\\Common7\\Tools\\",VSCODE_GIT_ASKPASS_EXTRA_ARGS:"--ms-enable-electron-run-as-node",VSCODE_GIT_ASKPASS_MAIN:"c:\\Users\\douga\\AppData\\Local\\Programs\\Microsoft VS Code\\resources\\app\\extensions\\git\\dist\\askpass-main.js",VSCODE_GIT_ASKPASS_NODE:"C:\\Users\\douga\\AppData\\Local\\Programs\\Microsoft VS Code\\Code.exe",VSCODE_GIT_IPC_HANDLE:"\\\\.\\pipe\\vscode-git-2da93b082d-sock",windir:"C:\\WINDOWS"}.DEBUG),a}function o(){try{return localStorage}catch{}}n.exports=Ks(e);const{formatters:c}=n.exports;c.j=function(a){try{return JSON.stringify(a)}catch(u){return"[UnexpectedJSONParseError]: "+u.message}}})(j,j.exports);var ft={exports:{}},dt={exports:{}};/*! safe-buffer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */(function(n,e){var t=Fe,r=t.Buffer;function i(o,c){for(var a in o)c[a]=o[a]}r.from&&r.alloc&&r.allocUnsafe&&r.allocUnsafeSlow?n.exports=t:(i(t,e),e.Buffer=s);function s(o,c,a){return r(o,c,a)}s.prototype=Object.create(r.prototype),i(r,s),s.from=function(o,c,a){if(typeof o=="number")throw new TypeError("Argument must not be a number");return r(o,c,a)},s.alloc=function(o,c,a){if(typeof o!="number")throw new TypeError("Argument must be a number");var u=r(o);return c!==void 0?typeof a=="string"?u.fill(c,a):u.fill(c):u.fill(0),u},s.allocUnsafe=function(o){if(typeof o!="number")throw new TypeError("Argument must be a number");return r(o)},s.allocUnsafeSlow=function(o){if(typeof o!="number")throw new TypeError("Argument must be a number");return t.SlowBuffer(o)}})(dt,dt.exports);var zt=65536,Js=4294967295;function Xs(){throw new Error(`Secure random number generation is not supported by this browser.
Use Chrome, Firefox or Internet Explorer 11`)}var Zs=dt.exports.Buffer,pt=N.crypto||N.msCrypto;pt&&pt.getRandomValues?ft.exports=eo:ft.exports=Xs;function eo(n,e){if(n>Js)throw new RangeError("requested too many random bytes");var t=Zs.allocUnsafe(n);if(n>0)if(n>zt)for(var r=0;r<n;r+=zt)pt.getRandomValues(t.slice(r,r+zt));else pt.getRandomValues(t);return typeof e=="function"?process.nextTick(function(){e(null,t)}):t}var _t={exports:{}},dr=ge.exports.EventEmitter;function pr(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(n,i).enumerable})),t.push.apply(t,r)}return t}function to(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?pr(Object(t),!0).forEach(function(r){no(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):pr(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}function no(n,e,t){return e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function ro(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function _r(n,e){for(var t=0;t<e.length;t++){var r=e[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(n,r.key,r)}}function io(n,e,t){return e&&_r(n.prototype,e),t&&_r(n,t),n}var so=Fe,gt=so.Buffer,oo=G,Qt=oo.inspect,ao=Qt&&Qt.custom||"inspect";function co(n,e,t){gt.prototype.copy.call(n,e,t)}var lo=function(){function n(){ro(this,n),this.head=null,this.tail=null,this.length=0}return io(n,[{key:"push",value:function(t){var r={data:t,next:null};this.length>0?this.tail.next=r:this.head=r,this.tail=r,++this.length}},{key:"unshift",value:function(t){var r={data:t,next:this.head};this.length===0&&(this.tail=r),this.head=r,++this.length}},{key:"shift",value:function(){if(this.length!==0){var t=this.head.data;return this.length===1?this.head=this.tail=null:this.head=this.head.next,--this.length,t}}},{key:"clear",value:function(){this.head=this.tail=null,this.length=0}},{key:"join",value:function(t){if(this.length===0)return"";for(var r=this.head,i=""+r.data;r=r.next;)i+=t+r.data;return i}},{key:"concat",value:function(t){if(this.length===0)return gt.alloc(0);for(var r=gt.allocUnsafe(t>>>0),i=this.head,s=0;i;)co(i.data,r,s),s+=i.data.length,i=i.next;return r}},{key:"consume",value:function(t,r){var i;return t<this.head.data.length?(i=this.head.data.slice(0,t),this.head.data=this.head.data.slice(t)):t===this.head.data.length?i=this.shift():i=r?this._getString(t):this._getBuffer(t),i}},{key:"first",value:function(){return this.head.data}},{key:"_getString",value:function(t){var r=this.head,i=1,s=r.data;for(t-=s.length;r=r.next;){var o=r.data,c=t>o.length?o.length:t;if(c===o.length?s+=o:s+=o.slice(0,t),t-=c,t===0){c===o.length?(++i,r.next?this.head=r.next:this.head=this.tail=null):(this.head=r,r.data=o.slice(c));break}++i}return this.length-=i,s}},{key:"_getBuffer",value:function(t){var r=gt.allocUnsafe(t),i=this.head,s=1;for(i.data.copy(r),t-=i.data.length;i=i.next;){var o=i.data,c=t>o.length?o.length:t;if(o.copy(r,r.length-t,0,c),t-=c,t===0){c===o.length?(++s,i.next?this.head=i.next:this.head=this.tail=null):(this.head=i,i.data=o.slice(c));break}++s}return this.length-=s,r}},{key:ao,value:function(t,r){return Qt(this,to({},r,{depth:0,customInspect:!1}))}}]),n}();function uo(n,e){var t=this,r=this._readableState&&this._readableState.destroyed,i=this._writableState&&this._writableState.destroyed;return r||i?(e?e(n):n&&(this._writableState?this._writableState.errorEmitted||(this._writableState.errorEmitted=!0,process.nextTick(Yt,this,n)):process.nextTick(Yt,this,n)),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(n||null,function(s){!e&&s?t._writableState?t._writableState.errorEmitted?process.nextTick(mt,t):(t._writableState.errorEmitted=!0,process.nextTick(gr,t,s)):process.nextTick(gr,t,s):e?(process.nextTick(mt,t),e(s)):process.nextTick(mt,t)}),this)}function gr(n,e){Yt(n,e),mt(n)}function mt(n){n._writableState&&!n._writableState.emitClose||n._readableState&&!n._readableState.emitClose||n.emit("close")}function ho(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}function Yt(n,e){n.emit("error",e)}function fo(n,e){var t=n._readableState,r=n._writableState;t&&t.autoDestroy||r&&r.autoDestroy?n.destroy(e):n.emit("error",e)}var mr={destroy:uo,undestroy:ho,errorOrDestroy:fo},re={};function po(n,e){n.prototype=Object.create(e.prototype),n.prototype.constructor=n,n.__proto__=e}var yr={};function A(n,e,t){t||(t=Error);function r(s,o,c){return typeof e=="string"?e:e(s,o,c)}var i=function(s){po(o,s);function o(c,a,u){return s.call(this,r(c,a,u))||this}return o}(t);i.prototype.name=t.name,i.prototype.code=n,yr[n]=i}function br(n,e){if(Array.isArray(n)){var t=n.length;return n=n.map(function(r){return String(r)}),t>2?"one of ".concat(e," ").concat(n.slice(0,t-1).join(", "),", or ")+n[t-1]:t===2?"one of ".concat(e," ").concat(n[0]," or ").concat(n[1]):"of ".concat(e," ").concat(n[0])}else return"of ".concat(e," ").concat(String(n))}function _o(n,e,t){return n.substr(!t||t<0?0:+t,e.length)===e}function go(n,e,t){return(t===void 0||t>n.length)&&(t=n.length),n.substring(t-e.length,t)===e}function mo(n,e,t){return typeof t!="number"&&(t=0),t+e.length>n.length?!1:n.indexOf(e,t)!==-1}A("ERR_INVALID_OPT_VALUE",function(n,e){return'The value "'+e+'" is invalid for option "'+n+'"'},TypeError);A("ERR_INVALID_ARG_TYPE",function(n,e,t){var r;typeof e=="string"&&_o(e,"not ")?(r="must not be",e=e.replace(/^not /,"")):r="must be";var i;if(go(n," argument"))i="The ".concat(n," ").concat(r," ").concat(br(e,"type"));else{var s=mo(n,".")?"property":"argument";i='The "'.concat(n,'" ').concat(s," ").concat(r," ").concat(br(e,"type"))}return i+=". Received type ".concat(typeof t),i},TypeError);A("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF");A("ERR_METHOD_NOT_IMPLEMENTED",function(n){return"The "+n+" method is not implemented"});A("ERR_STREAM_PREMATURE_CLOSE","Premature close");A("ERR_STREAM_DESTROYED",function(n){return"Cannot call "+n+" after a stream was destroyed"});A("ERR_MULTIPLE_CALLBACK","Callback called multiple times");A("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable");A("ERR_STREAM_WRITE_AFTER_END","write after end");A("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError);A("ERR_UNKNOWN_ENCODING",function(n){return"Unknown encoding: "+n},TypeError);A("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event");re.codes=yr;var yo=re.codes.ERR_INVALID_OPT_VALUE;function bo(n,e,t){return n.highWaterMark!=null?n.highWaterMark:e?n[t]:null}function vo(n,e,t,r){var i=bo(e,r,t);if(i!=null){if(!(isFinite(i)&&Math.floor(i)===i)||i<0){var s=r?t:"highWaterMark";throw new yo(s,i)}return Math.floor(i)}return n.objectMode?16:16*1024}var vr={getHighWaterMark:vo},wo=Eo;function Eo(n,e){if(Kt("noDeprecation"))return n;var t=!1;function r(){if(!t){if(Kt("throwDeprecation"))throw new Error(e);Kt("traceDeprecation")?console.trace(e):console.warn(e),t=!0}return n.apply(this,arguments)}return r}function Kt(n){try{if(!N.localStorage)return!1}catch{return!1}var e=N.localStorage[n];return e==null?!1:String(e).toLowerCase()==="true"}var wr=C;function Er(n){var e=this;this.next=null,this.entry=null,this.finish=function(){Yo(e,n)}}var we;C.WritableState=je;var So={deprecate:wo},Sr=dr,yt=Fe.Buffer,Co=N.Uint8Array||function(){};function Ro(n){return yt.from(n)}function To(n){return yt.isBuffer(n)||n instanceof Co}var Jt=mr,Po=vr,Oo=Po.getHighWaterMark,V=re.codes,Ao=V.ERR_INVALID_ARG_TYPE,ko=V.ERR_METHOD_NOT_IMPLEMENTED,No=V.ERR_MULTIPLE_CALLBACK,Lo=V.ERR_STREAM_CANNOT_PIPE,Mo=V.ERR_STREAM_DESTROYED,Io=V.ERR_STREAM_NULL_VALUES,Do=V.ERR_STREAM_WRITE_AFTER_END,xo=V.ERR_UNKNOWN_ENCODING,Ee=Jt.errorOrDestroy;xe.exports(C,Sr);function Fo(){}function je(n,e,t){we=we||Se,n=n||{},typeof t!="boolean"&&(t=e instanceof we),this.objectMode=!!n.objectMode,t&&(this.objectMode=this.objectMode||!!n.writableObjectMode),this.highWaterMark=Oo(this,n,"writableHighWaterMark",t),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var r=n.decodeStrings===!1;this.decodeStrings=!r,this.defaultEncoding=n.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(i){Ho(e,i)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=n.emitClose!==!1,this.autoDestroy=!!n.autoDestroy,this.bufferedRequestCount=0,this.corkedRequestsFree=new Er(this)}je.prototype.getBuffer=function(){for(var e=this.bufferedRequest,t=[];e;)t.push(e),e=e.next;return t};(function(){try{Object.defineProperty(je.prototype,"buffer",{get:So.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch{}})();var bt;typeof Symbol=="function"&&Symbol.hasInstance&&typeof Function.prototype[Symbol.hasInstance]=="function"?(bt=Function.prototype[Symbol.hasInstance],Object.defineProperty(C,Symbol.hasInstance,{value:function(e){return bt.call(this,e)?!0:this!==C?!1:e&&e._writableState instanceof je}})):bt=function(e){return e instanceof this};function C(n){we=we||Se;var e=this instanceof we;if(!e&&!bt.call(C,this))return new C(n);this._writableState=new je(n,this,e),this.writable=!0,n&&(typeof n.write=="function"&&(this._write=n.write),typeof n.writev=="function"&&(this._writev=n.writev),typeof n.destroy=="function"&&(this._destroy=n.destroy),typeof n.final=="function"&&(this._final=n.final)),Sr.call(this)}C.prototype.pipe=function(){Ee(this,new Lo)};function qo(n,e){var t=new Do;Ee(n,t),process.nextTick(e,t)}function jo(n,e,t,r){var i;return t===null?i=new Io:typeof t!="string"&&!e.objectMode&&(i=new Ao("chunk",["string","Buffer"],t)),i?(Ee(n,i),process.nextTick(r,i),!1):!0}C.prototype.write=function(n,e,t){var r=this._writableState,i=!1,s=!r.objectMode&&To(n);return s&&!yt.isBuffer(n)&&(n=Ro(n)),typeof e=="function"&&(t=e,e=null),s?e="buffer":e||(e=r.defaultEncoding),typeof t!="function"&&(t=Fo),r.ending?qo(this,t):(s||jo(this,r,n,t))&&(r.pendingcb++,i=Bo(this,r,s,n,e,t)),i};C.prototype.cork=function(){this._writableState.corked++};C.prototype.uncork=function(){var n=this._writableState;n.corked&&(n.corked--,!n.writing&&!n.corked&&!n.bufferProcessing&&n.bufferedRequest&&Rr(this,n))};C.prototype.setDefaultEncoding=function(e){if(typeof e=="string"&&(e=e.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase())>-1))throw new xo(e);return this._writableState.defaultEncoding=e,this};Object.defineProperty(C.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}});function $o(n,e,t){return!n.objectMode&&n.decodeStrings!==!1&&typeof e=="string"&&(e=yt.from(e,t)),e}Object.defineProperty(C.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}});function Bo(n,e,t,r,i,s){if(!t){var o=$o(e,r,i);r!==o&&(t=!0,i="buffer",r=o)}var c=e.objectMode?1:r.length;e.length+=c;var a=e.length<e.highWaterMark;if(a||(e.needDrain=!0),e.writing||e.corked){var u=e.lastBufferedRequest;e.lastBufferedRequest={chunk:r,encoding:i,isBuf:t,callback:s,next:null},u?u.next=e.lastBufferedRequest:e.bufferedRequest=e.lastBufferedRequest,e.bufferedRequestCount+=1}else Xt(n,e,!1,c,r,i,s);return a}function Xt(n,e,t,r,i,s,o){e.writelen=r,e.writecb=o,e.writing=!0,e.sync=!0,e.destroyed?e.onwrite(new Mo("write")):t?n._writev(i,e.onwrite):n._write(i,s,e.onwrite),e.sync=!1}function Uo(n,e,t,r,i){--e.pendingcb,t?(process.nextTick(i,r),process.nextTick($e,n,e),n._writableState.errorEmitted=!0,Ee(n,r)):(i(r),n._writableState.errorEmitted=!0,Ee(n,r),$e(n,e))}function Wo(n){n.writing=!1,n.writecb=null,n.length-=n.writelen,n.writelen=0}function Ho(n,e){var t=n._writableState,r=t.sync,i=t.writecb;if(typeof i!="function")throw new No;if(Wo(t),e)Uo(n,t,r,e,i);else{var s=Tr(t)||n.destroyed;!s&&!t.corked&&!t.bufferProcessing&&t.bufferedRequest&&Rr(n,t),r?process.nextTick(Cr,n,t,s,i):Cr(n,t,s,i)}}function Cr(n,e,t,r){t||Go(n,e),e.pendingcb--,r(),$e(n,e)}function Go(n,e){e.length===0&&e.needDrain&&(e.needDrain=!1,n.emit("drain"))}function Rr(n,e){e.bufferProcessing=!0;var t=e.bufferedRequest;if(n._writev&&t&&t.next){var r=e.bufferedRequestCount,i=new Array(r),s=e.corkedRequestsFree;s.entry=t;for(var o=0,c=!0;t;)i[o]=t,t.isBuf||(c=!1),t=t.next,o+=1;i.allBuffers=c,Xt(n,e,!0,e.length,i,"",s.finish),e.pendingcb++,e.lastBufferedRequest=null,s.next?(e.corkedRequestsFree=s.next,s.next=null):e.corkedRequestsFree=new Er(e),e.bufferedRequestCount=0}else{for(;t;){var a=t.chunk,u=t.encoding,l=t.callback,h=e.objectMode?1:a.length;if(Xt(n,e,!1,h,a,u,l),t=t.next,e.bufferedRequestCount--,e.writing)break}t===null&&(e.lastBufferedRequest=null)}e.bufferedRequest=t,e.bufferProcessing=!1}C.prototype._write=function(n,e,t){t(new ko("_write()"))};C.prototype._writev=null;C.prototype.end=function(n,e,t){var r=this._writableState;return typeof n=="function"?(t=n,n=null,e=null):typeof e=="function"&&(t=e,e=null),n!=null&&this.write(n,e),r.corked&&(r.corked=1,this.uncork()),r.ending||Qo(this,r,t),this};Object.defineProperty(C.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}});function Tr(n){return n.ending&&n.length===0&&n.bufferedRequest===null&&!n.finished&&!n.writing}function Vo(n,e){n._final(function(t){e.pendingcb--,t&&Ee(n,t),e.prefinished=!0,n.emit("prefinish"),$e(n,e)})}function zo(n,e){!e.prefinished&&!e.finalCalled&&(typeof n._final=="function"&&!e.destroyed?(e.pendingcb++,e.finalCalled=!0,process.nextTick(Vo,n,e)):(e.prefinished=!0,n.emit("prefinish")))}function $e(n,e){var t=Tr(e);if(t&&(zo(n,e),e.pendingcb===0&&(e.finished=!0,n.emit("finish"),e.autoDestroy))){var r=n._readableState;(!r||r.autoDestroy&&r.endEmitted)&&n.destroy()}return t}function Qo(n,e,t){e.ending=!0,$e(n,e),t&&(e.finished?process.nextTick(t):n.once("finish",t)),e.ended=!0,n.writable=!1}function Yo(n,e,t){var r=n.entry;for(n.entry=null;r;){var i=r.callback;e.pendingcb--,i(t),r=r.next}e.corkedRequestsFree.next=n}Object.defineProperty(C.prototype,"destroyed",{enumerable:!1,get:function(){return this._writableState===void 0?!1:this._writableState.destroyed},set:function(e){!this._writableState||(this._writableState.destroyed=e)}});C.prototype.destroy=Jt.destroy;C.prototype._undestroy=Jt.undestroy;C.prototype._destroy=function(n,e){e(n)};var Ko=Object.keys||function(n){var e=[];for(var t in n)e.push(t);return e},Se=I,Pr=Lr,Zt=wr;xe.exports(I,Pr);for(var Or=Ko(Zt.prototype),en=0;en<Or.length;en++){var tn=Or[en];I.prototype[tn]||(I.prototype[tn]=Zt.prototype[tn])}function I(n){if(!(this instanceof I))return new I(n);Pr.call(this,n),Zt.call(this,n),this.allowHalfOpen=!0,n&&(n.readable===!1&&(this.readable=!1),n.writable===!1&&(this.writable=!1),n.allowHalfOpen===!1&&(this.allowHalfOpen=!1,this.once("end",Jo)))}Object.defineProperty(I.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}});Object.defineProperty(I.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}});Object.defineProperty(I.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}});function Jo(){this._writableState.ended||process.nextTick(Xo,this)}function Xo(n){n.end()}Object.defineProperty(I.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState===void 0||this._writableState===void 0?!1:this._readableState.destroyed&&this._writableState.destroyed},set:function(e){this._readableState===void 0||this._writableState===void 0||(this._readableState.destroyed=e,this._writableState.destroyed=e)}});var nn={},rn=dt.exports.Buffer,Ar=rn.isEncoding||function(n){switch(n=""+n,n&&n.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function Zo(n){if(!n)return"utf8";for(var e;;)switch(n){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return n;default:if(e)return;n=(""+n).toLowerCase(),e=!0}}function ea(n){var e=Zo(n);if(typeof e!="string"&&(rn.isEncoding===Ar||!Ar(n)))throw new Error("Unknown encoding: "+n);return e||n}nn.StringDecoder=Be;function Be(n){this.encoding=ea(n);var e;switch(this.encoding){case"utf16le":this.text=oa,this.end=aa,e=4;break;case"utf8":this.fillLast=ra,e=4;break;case"base64":this.text=ca,this.end=la,e=3;break;default:this.write=ua,this.end=ha;return}this.lastNeed=0,this.lastTotal=0,this.lastChar=rn.allocUnsafe(e)}Be.prototype.write=function(n){if(n.length===0)return"";var e,t;if(this.lastNeed){if(e=this.fillLast(n),e===void 0)return"";t=this.lastNeed,this.lastNeed=0}else t=0;return t<n.length?e?e+this.text(n,t):this.text(n,t):e||""};Be.prototype.end=sa;Be.prototype.text=ia;Be.prototype.fillLast=function(n){if(this.lastNeed<=n.length)return n.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);n.copy(this.lastChar,this.lastTotal-this.lastNeed,0,n.length),this.lastNeed-=n.length};function sn(n){return n<=127?0:n>>5==6?2:n>>4==14?3:n>>3==30?4:n>>6==2?-1:-2}function ta(n,e,t){var r=e.length-1;if(r<t)return 0;var i=sn(e[r]);return i>=0?(i>0&&(n.lastNeed=i-1),i):--r<t||i===-2?0:(i=sn(e[r]),i>=0?(i>0&&(n.lastNeed=i-2),i):--r<t||i===-2?0:(i=sn(e[r]),i>=0?(i>0&&(i===2?i=0:n.lastNeed=i-3),i):0))}function na(n,e,t){if((e[0]&192)!=128)return n.lastNeed=0,"\uFFFD";if(n.lastNeed>1&&e.length>1){if((e[1]&192)!=128)return n.lastNeed=1,"\uFFFD";if(n.lastNeed>2&&e.length>2&&(e[2]&192)!=128)return n.lastNeed=2,"\uFFFD"}}function ra(n){var e=this.lastTotal-this.lastNeed,t=na(this,n);if(t!==void 0)return t;if(this.lastNeed<=n.length)return n.copy(this.lastChar,e,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);n.copy(this.lastChar,e,0,n.length),this.lastNeed-=n.length}function ia(n,e){var t=ta(this,n,e);if(!this.lastNeed)return n.toString("utf8",e);this.lastTotal=t;var r=n.length-(t-this.lastNeed);return n.copy(this.lastChar,0,r),n.toString("utf8",e,r)}function sa(n){var e=n&&n.length?this.write(n):"";return this.lastNeed?e+"\uFFFD":e}function oa(n,e){if((n.length-e)%2==0){var t=n.toString("utf16le",e);if(t){var r=t.charCodeAt(t.length-1);if(r>=55296&&r<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=n[n.length-2],this.lastChar[1]=n[n.length-1],t.slice(0,-1)}return t}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=n[n.length-1],n.toString("utf16le",e,n.length-1)}function aa(n){var e=n&&n.length?this.write(n):"";if(this.lastNeed){var t=this.lastTotal-this.lastNeed;return e+this.lastChar.toString("utf16le",0,t)}return e}function ca(n,e){var t=(n.length-e)%3;return t===0?n.toString("base64",e):(this.lastNeed=3-t,this.lastTotal=3,t===1?this.lastChar[0]=n[n.length-1]:(this.lastChar[0]=n[n.length-2],this.lastChar[1]=n[n.length-1]),n.toString("base64",e,n.length-t))}function la(n){var e=n&&n.length?this.write(n):"";return this.lastNeed?e+this.lastChar.toString("base64",0,3-this.lastNeed):e}function ua(n){return n.toString(this.encoding)}function ha(n){return n&&n.length?this.write(n):""}var kr=re.codes.ERR_STREAM_PREMATURE_CLOSE;function fa(n){var e=!1;return function(){if(!e){e=!0;for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];n.apply(this,r)}}}function da(){}function pa(n){return n.setHeader&&typeof n.abort=="function"}function Nr(n,e,t){if(typeof e=="function")return Nr(n,null,e);e||(e={}),t=fa(t||da);var r=e.readable||e.readable!==!1&&n.readable,i=e.writable||e.writable!==!1&&n.writable,s=function(){n.writable||c()},o=n._writableState&&n._writableState.finished,c=function(){i=!1,o=!0,r||t.call(n)},a=n._readableState&&n._readableState.endEmitted,u=function(){r=!1,a=!0,i||t.call(n)},l=function(d){t.call(n,d)},h=function(){var d;if(r&&!a)return(!n._readableState||!n._readableState.ended)&&(d=new kr),t.call(n,d);if(i&&!o)return(!n._writableState||!n._writableState.ended)&&(d=new kr),t.call(n,d)},f=function(){n.req.on("finish",c)};return pa(n)?(n.on("complete",c),n.on("abort",h),n.req?f():n.on("request",f)):i&&!n._writableState&&(n.on("end",s),n.on("close",s)),n.on("end",u),n.on("finish",c),e.error!==!1&&n.on("error",l),n.on("close",h),function(){n.removeListener("complete",c),n.removeListener("abort",h),n.removeListener("request",f),n.req&&n.req.removeListener("finish",c),n.removeListener("end",s),n.removeListener("close",s),n.removeListener("finish",c),n.removeListener("end",u),n.removeListener("error",l),n.removeListener("close",h)}}var on=Nr,vt;function z(n,e,t){return e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}var _a=on,Q=Symbol("lastResolve"),ie=Symbol("lastReject"),Ue=Symbol("error"),wt=Symbol("ended"),se=Symbol("lastPromise"),an=Symbol("handlePromise"),oe=Symbol("stream");function Y(n,e){return{value:n,done:e}}function ga(n){var e=n[Q];if(e!==null){var t=n[oe].read();t!==null&&(n[se]=null,n[Q]=null,n[ie]=null,e(Y(t,!1)))}}function ma(n){process.nextTick(ga,n)}function ya(n,e){return function(t,r){n.then(function(){if(e[wt]){t(Y(void 0,!0));return}e[an](t,r)},r)}}var ba=Object.getPrototypeOf(function(){}),va=Object.setPrototypeOf((vt={get stream(){return this[oe]},next:function(){var e=this,t=this[Ue];if(t!==null)return Promise.reject(t);if(this[wt])return Promise.resolve(Y(void 0,!0));if(this[oe].destroyed)return new Promise(function(o,c){process.nextTick(function(){e[Ue]?c(e[Ue]):o(Y(void 0,!0))})});var r=this[se],i;if(r)i=new Promise(ya(r,this));else{var s=this[oe].read();if(s!==null)return Promise.resolve(Y(s,!1));i=new Promise(this[an])}return this[se]=i,i}},z(vt,Symbol.asyncIterator,function(){return this}),z(vt,"return",function(){var e=this;return new Promise(function(t,r){e[oe].destroy(null,function(i){if(i){r(i);return}t(Y(void 0,!0))})})}),vt),ba),wa=function(e){var t,r=Object.create(va,(t={},z(t,oe,{value:e,writable:!0}),z(t,Q,{value:null,writable:!0}),z(t,ie,{value:null,writable:!0}),z(t,Ue,{value:null,writable:!0}),z(t,wt,{value:e._readableState.endEmitted,writable:!0}),z(t,an,{value:function(s,o){var c=r[oe].read();c?(r[se]=null,r[Q]=null,r[ie]=null,s(Y(c,!1))):(r[Q]=s,r[ie]=o)},writable:!0}),t));return r[se]=null,_a(e,function(i){if(i&&i.code!=="ERR_STREAM_PREMATURE_CLOSE"){var s=r[ie];s!==null&&(r[se]=null,r[Q]=null,r[ie]=null,s(i)),r[Ue]=i;return}var o=r[Q];o!==null&&(r[se]=null,r[Q]=null,r[ie]=null,o(Y(void 0,!0))),r[wt]=!0}),e.on("readable",ma.bind(null,r)),r},Ea=wa,Sa=function(){throw new Error("Readable.from is not available in the browser")},Lr=v,Ce;v.ReadableState=Ir;ge.exports.EventEmitter;var Mr=function(e,t){return e.listeners(t).length},We=dr,Et=Fe.Buffer,Ca=N.Uint8Array||function(){};function Ra(n){return Et.from(n)}function Ta(n){return Et.isBuffer(n)||n instanceof Ca}var cn=G,y;cn&&cn.debuglog?y=cn.debuglog("stream"):y=function(){};var Pa=lo,ln=mr,Oa=vr,Aa=Oa.getHighWaterMark,St=re.codes,ka=St.ERR_INVALID_ARG_TYPE,Na=St.ERR_STREAM_PUSH_AFTER_EOF,La=St.ERR_METHOD_NOT_IMPLEMENTED,Ma=St.ERR_STREAM_UNSHIFT_AFTER_END_EVENT,Re,un,hn;xe.exports(v,We);var He=ln.errorOrDestroy,fn=["error","close","destroy","pause","resume"];function Ia(n,e,t){if(typeof n.prependListener=="function")return n.prependListener(e,t);!n._events||!n._events[e]?n.on(e,t):Array.isArray(n._events[e])?n._events[e].unshift(t):n._events[e]=[t,n._events[e]]}function Ir(n,e,t){Ce=Ce||Se,n=n||{},typeof t!="boolean"&&(t=e instanceof Ce),this.objectMode=!!n.objectMode,t&&(this.objectMode=this.objectMode||!!n.readableObjectMode),this.highWaterMark=Aa(this,n,"readableHighWaterMark",t),this.buffer=new Pa,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.paused=!0,this.emitClose=n.emitClose!==!1,this.autoDestroy=!!n.autoDestroy,this.destroyed=!1,this.defaultEncoding=n.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,n.encoding&&(Re||(Re=nn.StringDecoder),this.decoder=new Re(n.encoding),this.encoding=n.encoding)}function v(n){if(Ce=Ce||Se,!(this instanceof v))return new v(n);var e=this instanceof Ce;this._readableState=new Ir(n,this,e),this.readable=!0,n&&(typeof n.read=="function"&&(this._read=n.read),typeof n.destroy=="function"&&(this._destroy=n.destroy)),We.call(this)}Object.defineProperty(v.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState===void 0?!1:this._readableState.destroyed},set:function(e){!this._readableState||(this._readableState.destroyed=e)}});v.prototype.destroy=ln.destroy;v.prototype._undestroy=ln.undestroy;v.prototype._destroy=function(n,e){e(n)};v.prototype.push=function(n,e){var t=this._readableState,r;return t.objectMode?r=!0:typeof n=="string"&&(e=e||t.defaultEncoding,e!==t.encoding&&(n=Et.from(n,e),e=""),r=!0),Dr(this,n,e,!1,r)};v.prototype.unshift=function(n){return Dr(this,n,null,!0,!1)};function Dr(n,e,t,r,i){y("readableAddChunk",e);var s=n._readableState;if(e===null)s.reading=!1,Fa(n,s);else{var o;if(i||(o=Da(s,e)),o)He(n,o);else if(s.objectMode||e&&e.length>0)if(typeof e!="string"&&!s.objectMode&&Object.getPrototypeOf(e)!==Et.prototype&&(e=Ra(e)),r)s.endEmitted?He(n,new Ma):dn(n,s,e,!0);else if(s.ended)He(n,new Na);else{if(s.destroyed)return!1;s.reading=!1,s.decoder&&!t?(e=s.decoder.write(e),s.objectMode||e.length!==0?dn(n,s,e,!1):pn(n,s)):dn(n,s,e,!1)}else r||(s.reading=!1,pn(n,s))}return!s.ended&&(s.length<s.highWaterMark||s.length===0)}function dn(n,e,t,r){e.flowing&&e.length===0&&!e.sync?(e.awaitDrain=0,n.emit("data",t)):(e.length+=e.objectMode?1:t.length,r?e.buffer.unshift(t):e.buffer.push(t),e.needReadable&&Ct(n)),pn(n,e)}function Da(n,e){var t;return!Ta(e)&&typeof e!="string"&&e!==void 0&&!n.objectMode&&(t=new ka("chunk",["string","Buffer","Uint8Array"],e)),t}v.prototype.isPaused=function(){return this._readableState.flowing===!1};v.prototype.setEncoding=function(n){Re||(Re=nn.StringDecoder);var e=new Re(n);this._readableState.decoder=e,this._readableState.encoding=this._readableState.decoder.encoding;for(var t=this._readableState.buffer.head,r="";t!==null;)r+=e.write(t.data),t=t.next;return this._readableState.buffer.clear(),r!==""&&this._readableState.buffer.push(r),this._readableState.length=r.length,this};var xr=1073741824;function xa(n){return n>=xr?n=xr:(n--,n|=n>>>1,n|=n>>>2,n|=n>>>4,n|=n>>>8,n|=n>>>16,n++),n}function Fr(n,e){return n<=0||e.length===0&&e.ended?0:e.objectMode?1:n!==n?e.flowing&&e.length?e.buffer.head.data.length:e.length:(n>e.highWaterMark&&(e.highWaterMark=xa(n)),n<=e.length?n:e.ended?e.length:(e.needReadable=!0,0))}v.prototype.read=function(n){y("read",n),n=parseInt(n,10);var e=this._readableState,t=n;if(n!==0&&(e.emittedReadable=!1),n===0&&e.needReadable&&((e.highWaterMark!==0?e.length>=e.highWaterMark:e.length>0)||e.ended))return y("read: emitReadable",e.length,e.ended),e.length===0&&e.ended?gn(this):Ct(this),null;if(n=Fr(n,e),n===0&&e.ended)return e.length===0&&gn(this),null;var r=e.needReadable;y("need readable",r),(e.length===0||e.length-n<e.highWaterMark)&&(r=!0,y("length less than watermark",r)),e.ended||e.reading?(r=!1,y("reading or ended",r)):r&&(y("do read"),e.reading=!0,e.sync=!0,e.length===0&&(e.needReadable=!0),this._read(e.highWaterMark),e.sync=!1,e.reading||(n=Fr(t,e)));var i;return n>0?i=$r(n,e):i=null,i===null?(e.needReadable=e.length<=e.highWaterMark,n=0):(e.length-=n,e.awaitDrain=0),e.length===0&&(e.ended||(e.needReadable=!0),t!==n&&e.ended&&gn(this)),i!==null&&this.emit("data",i),i};function Fa(n,e){if(y("onEofChunk"),!e.ended){if(e.decoder){var t=e.decoder.end();t&&t.length&&(e.buffer.push(t),e.length+=e.objectMode?1:t.length)}e.ended=!0,e.sync?Ct(n):(e.needReadable=!1,e.emittedReadable||(e.emittedReadable=!0,qr(n)))}}function Ct(n){var e=n._readableState;y("emitReadable",e.needReadable,e.emittedReadable),e.needReadable=!1,e.emittedReadable||(y("emitReadable",e.flowing),e.emittedReadable=!0,process.nextTick(qr,n))}function qr(n){var e=n._readableState;y("emitReadable_",e.destroyed,e.length,e.ended),!e.destroyed&&(e.length||e.ended)&&(n.emit("readable"),e.emittedReadable=!1),e.needReadable=!e.flowing&&!e.ended&&e.length<=e.highWaterMark,_n(n)}function pn(n,e){e.readingMore||(e.readingMore=!0,process.nextTick(qa,n,e))}function qa(n,e){for(;!e.reading&&!e.ended&&(e.length<e.highWaterMark||e.flowing&&e.length===0);){var t=e.length;if(y("maybeReadMore read 0"),n.read(0),t===e.length)break}e.readingMore=!1}v.prototype._read=function(n){He(this,new La("_read()"))};v.prototype.pipe=function(n,e){var t=this,r=this._readableState;switch(r.pipesCount){case 0:r.pipes=n;break;case 1:r.pipes=[r.pipes,n];break;default:r.pipes.push(n);break}r.pipesCount+=1,y("pipe count=%d opts=%j",r.pipesCount,e);var i=(!e||e.end!==!1)&&n!==process.stdout&&n!==process.stderr,s=i?c:m;r.endEmitted?process.nextTick(s):t.once("end",s),n.on("unpipe",o);function o(p,E){y("onunpipe"),p===t&&E&&E.hasUnpiped===!1&&(E.hasUnpiped=!0,l())}function c(){y("onend"),n.end()}var a=ja(t);n.on("drain",a);var u=!1;function l(){y("cleanup"),n.removeListener("close",_),n.removeListener("finish",d),n.removeListener("drain",a),n.removeListener("error",f),n.removeListener("unpipe",o),t.removeListener("end",c),t.removeListener("end",m),t.removeListener("data",h),u=!0,r.awaitDrain&&(!n._writableState||n._writableState.needDrain)&&a()}t.on("data",h);function h(p){y("ondata");var E=n.write(p);y("dest.write",E),E===!1&&((r.pipesCount===1&&r.pipes===n||r.pipesCount>1&&Br(r.pipes,n)!==-1)&&!u&&(y("false write response, pause",r.awaitDrain),r.awaitDrain++),t.pause())}function f(p){y("onerror",p),m(),n.removeListener("error",f),Mr(n,"error")===0&&He(n,p)}Ia(n,"error",f);function _(){n.removeListener("finish",d),m()}n.once("close",_);function d(){y("onfinish"),n.removeListener("close",_),m()}n.once("finish",d);function m(){y("unpipe"),t.unpipe(n)}return n.emit("pipe",t),r.flowing||(y("pipe resume"),t.resume()),n};function ja(n){return function(){var t=n._readableState;y("pipeOnDrain",t.awaitDrain),t.awaitDrain&&t.awaitDrain--,t.awaitDrain===0&&Mr(n,"data")&&(t.flowing=!0,_n(n))}}v.prototype.unpipe=function(n){var e=this._readableState,t={hasUnpiped:!1};if(e.pipesCount===0)return this;if(e.pipesCount===1)return n&&n!==e.pipes?this:(n||(n=e.pipes),e.pipes=null,e.pipesCount=0,e.flowing=!1,n&&n.emit("unpipe",this,t),this);if(!n){var r=e.pipes,i=e.pipesCount;e.pipes=null,e.pipesCount=0,e.flowing=!1;for(var s=0;s<i;s++)r[s].emit("unpipe",this,{hasUnpiped:!1});return this}var o=Br(e.pipes,n);return o===-1?this:(e.pipes.splice(o,1),e.pipesCount-=1,e.pipesCount===1&&(e.pipes=e.pipes[0]),n.emit("unpipe",this,t),this)};v.prototype.on=function(n,e){var t=We.prototype.on.call(this,n,e),r=this._readableState;return n==="data"?(r.readableListening=this.listenerCount("readable")>0,r.flowing!==!1&&this.resume()):n==="readable"&&!r.endEmitted&&!r.readableListening&&(r.readableListening=r.needReadable=!0,r.flowing=!1,r.emittedReadable=!1,y("on readable",r.length,r.reading),r.length?Ct(this):r.reading||process.nextTick($a,this)),t};v.prototype.addListener=v.prototype.on;v.prototype.removeListener=function(n,e){var t=We.prototype.removeListener.call(this,n,e);return n==="readable"&&process.nextTick(jr,this),t};v.prototype.removeAllListeners=function(n){var e=We.prototype.removeAllListeners.apply(this,arguments);return(n==="readable"||n===void 0)&&process.nextTick(jr,this),e};function jr(n){var e=n._readableState;e.readableListening=n.listenerCount("readable")>0,e.resumeScheduled&&!e.paused?e.flowing=!0:n.listenerCount("data")>0&&n.resume()}function $a(n){y("readable nexttick read 0"),n.read(0)}v.prototype.resume=function(){var n=this._readableState;return n.flowing||(y("resume"),n.flowing=!n.readableListening,Ba(this,n)),n.paused=!1,this};function Ba(n,e){e.resumeScheduled||(e.resumeScheduled=!0,process.nextTick(Ua,n,e))}function Ua(n,e){y("resume",e.reading),e.reading||n.read(0),e.resumeScheduled=!1,n.emit("resume"),_n(n),e.flowing&&!e.reading&&n.read(0)}v.prototype.pause=function(){return y("call pause flowing=%j",this._readableState.flowing),this._readableState.flowing!==!1&&(y("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState.paused=!0,this};function _n(n){var e=n._readableState;for(y("flow",e.flowing);e.flowing&&n.read()!==null;);}v.prototype.wrap=function(n){var e=this,t=this._readableState,r=!1;n.on("end",function(){if(y("wrapped end"),t.decoder&&!t.ended){var o=t.decoder.end();o&&o.length&&e.push(o)}e.push(null)}),n.on("data",function(o){if(y("wrapped data"),t.decoder&&(o=t.decoder.write(o)),!(t.objectMode&&o==null)&&!(!t.objectMode&&(!o||!o.length))){var c=e.push(o);c||(r=!0,n.pause())}});for(var i in n)this[i]===void 0&&typeof n[i]=="function"&&(this[i]=function(c){return function(){return n[c].apply(n,arguments)}}(i));for(var s=0;s<fn.length;s++)n.on(fn[s],this.emit.bind(this,fn[s]));return this._read=function(o){y("wrapped _read",o),r&&(r=!1,n.resume())},this};typeof Symbol=="function"&&(v.prototype[Symbol.asyncIterator]=function(){return un===void 0&&(un=Ea),un(this)});Object.defineProperty(v.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}});Object.defineProperty(v.prototype,"readableBuffer",{enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}});Object.defineProperty(v.prototype,"readableFlowing",{enumerable:!1,get:function(){return this._readableState.flowing},set:function(e){this._readableState&&(this._readableState.flowing=e)}});v._fromList=$r;Object.defineProperty(v.prototype,"readableLength",{enumerable:!1,get:function(){return this._readableState.length}});function $r(n,e){if(e.length===0)return null;var t;return e.objectMode?t=e.buffer.shift():!n||n>=e.length?(e.decoder?t=e.buffer.join(""):e.buffer.length===1?t=e.buffer.first():t=e.buffer.concat(e.length),e.buffer.clear()):t=e.buffer.consume(n,e.decoder),t}function gn(n){var e=n._readableState;y("endReadable",e.endEmitted),e.endEmitted||(e.ended=!0,process.nextTick(Wa,e,n))}function Wa(n,e){if(y("endReadableNT",n.endEmitted,n.length),!n.endEmitted&&n.length===0&&(n.endEmitted=!0,e.readable=!1,e.emit("end"),n.autoDestroy)){var t=e._writableState;(!t||t.autoDestroy&&t.finished)&&e.destroy()}}typeof Symbol=="function"&&(v.from=function(n,e){return hn===void 0&&(hn=Sa),hn(v,n,e)});function Br(n,e){for(var t=0,r=n.length;t<r;t++)if(n[t]===e)return t;return-1}var Ur=$,Rt=re.codes,Ha=Rt.ERR_METHOD_NOT_IMPLEMENTED,Ga=Rt.ERR_MULTIPLE_CALLBACK,Va=Rt.ERR_TRANSFORM_ALREADY_TRANSFORMING,za=Rt.ERR_TRANSFORM_WITH_LENGTH_0,Tt=Se;xe.exports($,Tt);function Qa(n,e){var t=this._transformState;t.transforming=!1;var r=t.writecb;if(r===null)return this.emit("error",new Ga);t.writechunk=null,t.writecb=null,e!=null&&this.push(e),r(n);var i=this._readableState;i.reading=!1,(i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}function $(n){if(!(this instanceof $))return new $(n);Tt.call(this,n),this._transformState={afterTransform:Qa.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,n&&(typeof n.transform=="function"&&(this._transform=n.transform),typeof n.flush=="function"&&(this._flush=n.flush)),this.on("prefinish",Ya)}function Ya(){var n=this;typeof this._flush=="function"&&!this._readableState.destroyed?this._flush(function(e,t){Wr(n,e,t)}):Wr(this,null,null)}$.prototype.push=function(n,e){return this._transformState.needTransform=!1,Tt.prototype.push.call(this,n,e)};$.prototype._transform=function(n,e,t){t(new Ha("_transform()"))};$.prototype._write=function(n,e,t){var r=this._transformState;if(r.writecb=t,r.writechunk=n,r.writeencoding=e,!r.transforming){var i=this._readableState;(r.needTransform||i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}};$.prototype._read=function(n){var e=this._transformState;e.writechunk!==null&&!e.transforming?(e.transforming=!0,this._transform(e.writechunk,e.writeencoding,e.afterTransform)):e.needTransform=!0};$.prototype._destroy=function(n,e){Tt.prototype._destroy.call(this,n,function(t){e(t)})};function Wr(n,e,t){if(e)return n.emit("error",e);if(t!=null&&n.push(t),n._writableState.length)throw new za;if(n._transformState.transforming)throw new Va;return n.push(null)}var Ka=Ge,Hr=Ur;xe.exports(Ge,Hr);function Ge(n){if(!(this instanceof Ge))return new Ge(n);Hr.call(this,n)}Ge.prototype._transform=function(n,e,t){t(null,n)};var mn;function Ja(n){var e=!1;return function(){e||(e=!0,n.apply(void 0,arguments))}}var Gr=re.codes,Xa=Gr.ERR_MISSING_ARGS,Za=Gr.ERR_STREAM_DESTROYED;function Vr(n){if(n)throw n}function ec(n){return n.setHeader&&typeof n.abort=="function"}function tc(n,e,t,r){r=Ja(r);var i=!1;n.on("close",function(){i=!0}),mn===void 0&&(mn=on),mn(n,{readable:e,writable:t},function(o){if(o)return r(o);i=!0,r()});var s=!1;return function(o){if(!i&&!s){if(s=!0,ec(n))return n.abort();if(typeof n.destroy=="function")return n.destroy();r(o||new Za("pipe"))}}}function zr(n){n()}function nc(n,e){return n.pipe(e)}function rc(n){return!n.length||typeof n[n.length-1]!="function"?Vr:n.pop()}function ic(){for(var n=arguments.length,e=new Array(n),t=0;t<n;t++)e[t]=arguments[t];var r=rc(e);if(Array.isArray(e[0])&&(e=e[0]),e.length<2)throw new Xa("streams");var i,s=e.map(function(o,c){var a=c<e.length-1,u=c>0;return tc(o,a,u,function(l){i||(i=l),l&&s.forEach(zr),!a&&(s.forEach(zr),r(i))})});return e.reduce(nc)}var sc=ic;(function(n,e){e=n.exports=Lr,e.Stream=e,e.Readable=e,e.Writable=wr,e.Duplex=Se,e.Transform=Ur,e.PassThrough=Ka,e.finished=on,e.pipeline=sc})(_t,_t.exports);/*! queue-microtask. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */let Qr;var Yr=typeof queueMicrotask=="function"?queueMicrotask.bind(typeof window!="undefined"?window:N):n=>(Qr||(Qr=Promise.resolve())).then(n).catch(e=>setTimeout(()=>{throw e},0));/*! simple-websocket. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */const oc=j.exports("simple-websocket"),ac=ft.exports,cc=_t.exports,Kr=Yr,Ve=G,ze=typeof Ve!="function"?WebSocket:Ve,Jr=64*1024;class Xr extends cc.Duplex{constructor(e={}){typeof e=="string"&&(e={url:e}),e=Object.assign({allowHalfOpen:!1},e);super(e);if(e.url==null&&e.socket==null)throw new Error("Missing required `url` or `socket` option");if(e.url!=null&&e.socket!=null)throw new Error("Must specify either `url` or `socket` option, not both");if(this._id=ac(4).toString("hex").slice(0,7),this._debug("new websocket: %o",e),this.connected=!1,this.destroyed=!1,this._chunk=null,this._cb=null,this._interval=null,e.socket)this.url=e.socket.url,this._ws=e.socket,this.connected=e.socket.readyState===ze.OPEN;else{this.url=e.url;try{typeof Ve=="function"?this._ws=new ze(e.url,null,q(R({},e),{encoding:void 0})):this._ws=new ze(e.url)}catch(t){Kr(()=>this.destroy(t));return}}this._ws.binaryType="arraybuffer",e.socket&&this.connected?Kr(()=>this._handleOpen()):this._ws.onopen=()=>this._handleOpen(),this._ws.onmessage=t=>this._handleMessage(t),this._ws.onclose=()=>this._handleClose(),this._ws.onerror=t=>this._handleError(t),this._handleFinishBound=()=>this._handleFinish(),this.once("finish",this._handleFinishBound)}send(e){this._ws.send(e)}destroy(e){this._destroy(e,()=>{})}_destroy(e,t){if(!this.destroyed){if(this._debug("destroy (error: %s)",e&&(e.message||e)),this.readable=this.writable=!1,this._readableState.ended||this.push(null),this._writableState.finished||this.end(),this.connected=!1,this.destroyed=!0,clearInterval(this._interval),this._interval=null,this._chunk=null,this._cb=null,this._handleFinishBound&&this.removeListener("finish",this._handleFinishBound),this._handleFinishBound=null,this._ws){const r=this._ws,i=()=>{r.onclose=null};if(r.readyState===ze.CLOSED)i();else try{r.onclose=i,r.close()}catch{i()}r.onopen=null,r.onmessage=null,r.onerror=()=>{}}this._ws=null,e&&this.emit("error",e),this.emit("close"),t()}}_read(){}_write(e,t,r){if(this.destroyed)return r(new Error("cannot write after socket is destroyed"));if(this.connected){try{this.send(e)}catch(i){return this.destroy(i)}typeof Ve!="function"&&this._ws.bufferedAmount>Jr?(this._debug("start backpressure: bufferedAmount %d",this._ws.bufferedAmount),this._cb=r):r(null)}else this._debug("write before connect"),this._chunk=e,this._cb=r}_handleOpen(){if(!(this.connected||this.destroyed)){if(this.connected=!0,this._chunk){try{this.send(this._chunk)}catch(t){return this.destroy(t)}this._chunk=null,this._debug('sent chunk from "write before connect"');const e=this._cb;this._cb=null,e(null)}typeof Ve!="function"&&(this._interval=setInterval(()=>this._onInterval(),150),this._interval.unref&&this._interval.unref()),this._debug("connect"),this.emit("connect")}}_handleMessage(e){if(this.destroyed)return;let t=e.data;t instanceof ArrayBuffer&&(t=Buffer.from(t)),this.push(t)}_handleClose(){this.destroyed||(this._debug("on close"),this.destroy())}_handleError(e){this.destroy(new Error(`Error connecting to ${this.url}`))}_handleFinish(){if(this.destroyed)return;const e=()=>{setTimeout(()=>this.destroy(),1e3)};this.connected?e():this.once("connect",e)}_onInterval(){if(!this._cb||!this._ws||this._ws.bufferedAmount>Jr)return;this._debug("ending backpressure: bufferedAmount %d",this._ws.bufferedAmount);const e=this._cb;this._cb=null,e(null)}_debug(){const e=[].slice.call(arguments);e[0]="["+this._id+"] "+e[0],oc.apply(null,e)}}Xr.WEBSOCKET_SUPPORT=!!ze;var lc=Xr,Te=null;typeof WebSocket!="undefined"?Te=WebSocket:typeof MozWebSocket!="undefined"?Te=MozWebSocket:typeof N!="undefined"?Te=N.WebSocket||N.MozWebSocket:typeof window!="undefined"?Te=window.WebSocket||window.MozWebSocket:typeof self!="undefined"&&(Te=self.WebSocket||self.MozWebSocket);var uc=Te,yn={exports:{}};const hc=(n,e)=>Math.floor(Math.random()*(e-n+1)+n),Zr=()=>{const n=new Error("Delay aborted");return n.name="AbortError",n},ei=({clearTimeout:n,setTimeout:e,willResolve:t})=>(r,{value:i,signal:s}={})=>{if(s&&s.aborted)return Promise.reject(Zr());let o,c,a;const u=n||clearTimeout,l=()=>{u(o),a(Zr())},h=()=>{s&&s.removeEventListener("abort",l)},f=new Promise((_,d)=>{c=()=>{h(),t?_(i):d(i)},a=d,o=(e||setTimeout)(c,r)});return s&&s.addEventListener("abort",l,{once:!0}),f.clear=()=>{u(o),o=null,c()},f},ti=n=>{const e=ei(q(R({},n),{willResolve:!0}));return e.reject=ei(q(R({},n),{willResolve:!1})),e.range=(t,r,i)=>e(hc(t,r),i),e},bn=ti();bn.createWithTimers=ti;yn.exports=bn;yn.exports.default=bn;var Pt={exports:{}};function fc(n){var e=new n,t=e;function r(){var s=e;return s.next?e=s.next:(e=new n,t=e),s.next=null,s}function i(s){t.next=s,t=s}return{get:r,release:i}}var dc=fc,pc=dc;function ni(n,e,t){if(typeof n=="function"&&(t=e,e=n,n=null),t<1)throw new Error("fastqueue concurrency must be greater than 1");var r=pc(_c),i=null,s=null,o=0,c=null,a={push:m,drain:k,saturated:k,pause:l,paused:!1,concurrency:t,running:u,resume:_,idle:d,length:h,getQueue:f,unshift:p,empty:k,kill:O,killAndDrain:g,error:T};return a;function u(){return o}function l(){a.paused=!0}function h(){for(var w=i,P=0;w;)w=w.next,P++;return P}function f(){for(var w=i,P=[];w;)P.push(w.value),w=w.next;return P}function _(){if(!!a.paused){a.paused=!1;for(var w=0;w<a.concurrency;w++)o++,E()}}function d(){return o===0&&a.length()===0}function m(w,P){var S=r.get();S.context=n,S.release=E,S.value=w,S.callback=P||k,S.errorHandler=c,o===a.concurrency||a.paused?s?(s.next=S,s=S):(i=S,s=S,a.saturated()):(o++,e.call(n,S.value,S.worked))}function p(w,P){var S=r.get();S.context=n,S.release=E,S.value=w,S.callback=P||k,o===a.concurrency||a.paused?i?(S.next=i,i=S):(i=S,s=S,a.saturated()):(o++,e.call(n,S.value,S.worked))}function E(w){w&&r.release(w);var P=i;P?a.paused?o--:(s===i&&(s=null),i=P.next,P.next=null,e.call(n,P.value,P.worked),s===null&&a.empty()):--o==0&&a.drain()}function O(){i=null,s=null,a.drain=k}function g(){i=null,s=null,a.drain(),a.drain=k}function T(w){c=w}}function k(){}function _c(){this.value=null,this.callback=k,this.next=null,this.release=k,this.context=null,this.errorHandler=null;var n=this;this.worked=function(t,r){var i=n.callback,s=n.errorHandler,o=n.value;n.value=null,n.callback=k,n.errorHandler&&s(t,o),i.call(n.context,t,r),n.release(n)}}function gc(n,e,t){typeof n=="function"&&(t=e,e=n,n=null);function r(l,h){e.call(this,l).then(function(f){h(null,f)},h)}var i=ni(n,r,t),s=i.push,o=i.unshift;return i.push=c,i.unshift=a,i.drained=u,i;function c(l){var h=new Promise(function(f,_){s(l,function(d,m){if(d){_(d);return}f(m)})});return h.catch(k),h}function a(l){var h=new Promise(function(f,_){o(l,function(d,m){if(d){_(d);return}f(m)})});return h.catch(k),h}function u(){var l=i.drain,h=new Promise(function(f){i.drain=function(){l(),f()}});return h}}Pt.exports=ni;Pt.exports.promise=gc;var ae={exports:{}},Qe={exports:{}},mc=(n,e)=>(e=e||(()=>{}),n.then(t=>new Promise(r=>{r(e())}).then(()=>t),t=>new Promise(r=>{r(e())}).then(()=>{throw t})));const yc=mc;class ri extends Error{constructor(e){super(e);this.name="TimeoutError"}}const ii=(n,e,t)=>new Promise((r,i)=>{if(typeof e!="number"||e<0)throw new TypeError("Expected `milliseconds` to be a positive number");if(e===1/0){r(n);return}const s=setTimeout(()=>{if(typeof t=="function"){try{r(t())}catch(a){i(a)}return}const o=typeof t=="string"?t:`Promise timed out after ${e} milliseconds`,c=t instanceof Error?t:new ri(o);typeof n.cancel=="function"&&n.cancel(),i(c)},e);yc(n.then(r,i),()=>{clearTimeout(s)})});Qe.exports=ii;Qe.exports.default=ii;Qe.exports.TimeoutError=ri;const si=Qe.exports,bc=Symbol.asyncIterator||"@@asyncIterator",oi=n=>{const e=n.on||n.addListener||n.addEventListener,t=n.off||n.removeListener||n.removeEventListener;if(!e||!t)throw new TypeError("Emitter is not compatible");return{addListener:e.bind(n),removeListener:t.bind(n)}},ai=n=>Array.isArray(n)?n:[n],ci=(n,e,t)=>{let r;const i=new Promise((s,o)=>{if(t=R({rejectionEvents:["error"],multiArgs:!1,resolveImmediately:!1},t),!(t.count>=0&&(t.count===1/0||Number.isInteger(t.count))))throw new TypeError("The `count` option should be at least 0 or more");const c=ai(e),a=[],{addListener:u,removeListener:l}=oi(n),h=(..._)=>{const d=t.multiArgs?_:_[0];t.filter&&!t.filter(d)||(a.push(d),t.count===a.length&&(r(),s(a)))},f=_=>{r(),o(_)};r=()=>{for(const _ of c)l(_,h);for(const _ of t.rejectionEvents)l(_,f)};for(const _ of c)u(_,h);for(const _ of t.rejectionEvents)u(_,f);t.resolveImmediately&&s(a)});if(i.cancel=r,typeof t.timeout=="number"){const s=si(i,t.timeout);return s.cancel=r,s}return i},li=(n,e,t)=>{typeof t=="function"&&(t={filter:t}),t=q(R({},t),{count:1,resolveImmediately:!1});const r=ci(n,e,t),i=r.then(s=>s[0]);return i.cancel=r.cancel,i};ae.exports=li;ae.exports.default=li;ae.exports.multiple=ci;ae.exports.iterator=(n,e,t)=>{typeof t=="function"&&(t={filter:t});const r=ai(e);t=R({rejectionEvents:["error"],resolutionEvents:[],limit:1/0,multiArgs:!1},t);const{limit:i}=t;if(!(i>=0&&(i===1/0||Number.isInteger(i))))throw new TypeError("The `limit` option should be a non-negative integer or Infinity");if(i===0)return{[Symbol.asyncIterator](){return this},async next(){return{done:!0,value:void 0}}};const{addListener:o,removeListener:c}=oi(n);let a=!1,u,l=!1;const h=[],f=[];let _=0,d=!1;const m=(...g)=>{_++,d=_===i;const T=t.multiArgs?g:g[0];if(h.length>0){const{resolve:w}=h.shift();w({done:!1,value:T}),d&&p();return}f.push(T),d&&p()},p=()=>{a=!0;for(const g of r)c(g,m);for(const g of t.rejectionEvents)c(g,E);for(const g of t.resolutionEvents)c(g,O);for(;h.length>0;){const{resolve:g}=h.shift();g({done:!0,value:void 0})}},E=(...g)=>{if(u=t.multiArgs?g:g[0],h.length>0){const{reject:T}=h.shift();T(u)}else l=!0;p()},O=(...g)=>{const T=t.multiArgs?g:g[0];if(!(t.filter&&!t.filter(T))){if(h.length>0){const{resolve:w}=h.shift();w({done:!0,value:T})}else f.push(T);p()}};for(const g of r)o(g,m);for(const g of t.rejectionEvents)o(g,E);for(const g of t.resolutionEvents)o(g,O);return{[bc](){return this},async next(){if(f.length>0){const g=f.shift();return{done:a&&f.length===0&&!d,value:g}}if(l)throw l=!1,u;return a?{done:!0,value:void 0}:new Promise((g,T)=>h.push({resolve:g,reject:T}))},async return(g){return p(),{done:a,value:g}}}};ae.exports.TimeoutError=si.TimeoutError;var Pe={exports:{}};const K=new WeakMap,Ot=new WeakMap,Ye=new WeakMap,vn=Symbol("anyProducer"),ui=Promise.resolve(),At=Symbol("listenerAdded"),kt=Symbol("listenerRemoved");function ce(n){if(typeof n!="string"&&typeof n!="symbol")throw new TypeError("eventName must be a string or a symbol")}function Nt(n){if(typeof n!="function")throw new TypeError("listener must be a function")}function Oe(n,e){const t=Ot.get(n);return t.has(e)||t.set(e,new Set),t.get(e)}function Ke(n,e){const t=typeof e=="string"?e:vn,r=Ye.get(n);return r.has(t)||r.set(t,new Set),r.get(t)}function vc(n,e,t){const r=Ye.get(n);if(r.has(e))for(const i of r.get(e))i.enqueue(t);if(r.has(vn)){const i=Promise.all([e,t]);for(const s of r.get(vn))s.enqueue(i)}}function hi(n,e){let t=!1,r=()=>{},i=[];const s={enqueue(o){i.push(o),r()},finish(){t=!0,r()}};return Ke(n,e).add(s),{async next(){return i?i.length===0?t?(i=void 0,this.next()):(await new Promise(o=>{r=o}),this.next()):{done:!1,value:await i.shift()}:{done:!0}},async return(o){return i=void 0,Ke(n,e).delete(s),r(),arguments.length>0?{done:!0,value:await o}:{done:!0}},[Symbol.asyncIterator](){return this}}}function fi(n){if(n===void 0)return di;if(!Array.isArray(n))throw new TypeError("`methodNames` must be an array of strings");for(const e of n)if(!di.includes(e))throw typeof e!="string"?new TypeError("`methodNames` element must be a string"):new Error(`${e} is not Emittery method`);return n}const wn=n=>n===At||n===kt;class B{static mixin(e,t){return t=fi(t),r=>{if(typeof r!="function")throw new TypeError("`target` must be function");for(const o of t)if(r.prototype[o]!==void 0)throw new Error(`The property \`${o}\` already exists on \`target\``);function i(){return Object.defineProperty(this,e,{enumerable:!1,value:new B}),this[e]}Object.defineProperty(r.prototype,e,{enumerable:!1,get:i});const s=o=>function(...c){return this[e][o](...c)};for(const o of t)Object.defineProperty(r.prototype,o,{enumerable:!1,value:s(o)});return r}}constructor(){K.set(this,new Set),Ot.set(this,new Map),Ye.set(this,new Map)}on(e,t){return ce(e),Nt(t),Oe(this,e).add(t),wn(e)||this.emit(At,{eventName:e,listener:t}),this.off.bind(this,e,t)}off(e,t){ce(e),Nt(t),wn(e)||this.emit(kt,{eventName:e,listener:t}),Oe(this,e).delete(t)}once(e){return new Promise(t=>{ce(e);const r=this.on(e,i=>{r(),t(i)})})}events(e){return ce(e),hi(this,e)}async emit(e,t){ce(e),vc(this,e,t);const r=Oe(this,e),i=K.get(this),s=[...r],o=wn(e)?[]:[...i];return await ui,Promise.all([...s.map(async c=>{if(r.has(c))return c(t)}),...o.map(async c=>{if(i.has(c))return c(e,t)})])}async emitSerial(e,t){ce(e);const r=Oe(this,e),i=K.get(this),s=[...r],o=[...i];await ui;for(const c of s)r.has(c)&&await c(t);for(const c of o)i.has(c)&&await c(e,t)}onAny(e){return Nt(e),K.get(this).add(e),this.emit(At,{listener:e}),this.offAny.bind(this,e)}anyEvent(){return hi(this)}offAny(e){Nt(e),this.emit(kt,{listener:e}),K.get(this).delete(e)}clearListeners(e){if(typeof e=="string"){Oe(this,e).clear();const t=Ke(this,e);for(const r of t)r.finish();t.clear()}else{K.get(this).clear();for(const t of Ot.get(this).values())t.clear();for(const t of Ye.get(this).values()){for(const r of t)r.finish();t.clear()}}}listenerCount(e){if(typeof e=="string")return K.get(this).size+Oe(this,e).size+Ke(this,e).size+Ke(this).size;typeof e!="undefined"&&ce(e);let t=K.get(this).size;for(const r of Ot.get(this).values())t+=r.size;for(const r of Ye.get(this).values())t+=r.size;return t}bindMethods(e,t){if(typeof e!="object"||e===null)throw new TypeError("`target` must be an object");t=fi(t);for(const r of t){if(e[r]!==void 0)throw new Error(`The property \`${r}\` already exists on \`target\``);Object.defineProperty(e,r,{enumerable:!1,value:this[r].bind(this)})}}}const di=Object.getOwnPropertyNames(B.prototype).filter(n=>n!=="constructor");B.Typed=class extends B{};Object.defineProperty(B.Typed,"Typed",{enumerable:!1,value:void 0});Object.defineProperty(B,"listenerAdded",{value:At,writable:!1,enumerable:!0,configurable:!1});Object.defineProperty(B,"listenerRemoved",{value:kt,writable:!1,enumerable:!0,configurable:!1});var wc=B,Ae={exports:{}},Lt={exports:{}},En={exports:{}};const ke=Symbol("opening when closing"),le=Symbol("opening queue"),U=Symbol("closing when inactive"),ue=Symbol("closing queue"),he=Symbol("sync"),Sn=Symbol("fast close"),pi=Symbol("allow reopen"),Cn=Symbol("init state");class _i{constructor(e){e||(e={}),e.open&&(this._open=e.open),e.close&&(this._close=e.close),this[Cn](),this[pi]=e.reopen||!1,this[ke]=null,this[le]=null,this[U]=null,this[ue]=null,this[he]=!1,this[Sn]=!0}[Cn](){this.opening=!1,this.opened=!1,this.closing=!1,this.closed=!1,this.actives=0}_open(e){e(null)}_close(e){e(null)}open(e){if(e||(e=yi),this.closing||this.closed){if(!this[pi])return process.nextTick(e,new Error("Resource is closed"));if(this.closing){this[ke]||(this[ke]=[]),this[ke].push(e);return}this[Cn]()}if(this.opened)return process.nextTick(e);if(this[le]){this[le].push(e);return}this.opening=!0,this[le]=[e],this[he]=!0,this._open(gi.bind(this)),this[he]=!1}active(e){return this[Sn]&&this[U]||this[ue]||this.closed?(e&&process.nextTick(e,new Error("Resource is closed")),!1):(this.actives++,!0)}inactive(e,t,r){if(!--this.actives){const i=this[U];if(i)for(this[U]=null;i.length;)this.close(i.shift())}e&&e(t,r)}close(e,t){if(typeof e=="function")return this.close(!1,e);if(t||(t=yi),e&&(this[Sn]=!1),this.closed)return process.nextTick(t);if(this.actives||this[le]){this[U]||(this[U]=[]),this[U].push(t);return}if(!this.opened){this.closed=!0,process.nextTick(t);return}if(this[ue]){this[ue].push(t);return}this.closing=!0,this[ue]=[t],this[he]=!0,this._close(mi.bind(this)),this[he]=!1}}function gi(n){if(this[he])return process.nextTick(gi.bind(this),n);const e=this[le];for(this[le]=null,this.opening=!1,this.opened=!n;e.length;)e.shift()(n);const t=this[U];if(t&&!this.actives)for(this[U]=null;t.length;)this.close(t.shift())}function mi(n){if(this[he])return process.nextTick(mi.bind(this),n);const e=this[ue];for(this.closing=!1,this[ue]=null,this.closed=!n;e.length;)e.shift()(n);const t=this[ke];if(t)for(this[ke]=null;t.length;)this.open(t.shift())}function yi(){}En.exports=n=>new _i(n);En.exports.Nanoresource=_i;const Ec=En.exports;function bi(){let n;const e=new Promise((t,r)=>{n=(i,s)=>{i?r(i):t(s)}});return n.promise=e,n}const D=Symbol("nanoresource"),Rn=Symbol("processpromise");class vi{constructor(e={}){const t=e.open||this._open.bind(this),r=e.close||this._close.bind(this);this[D]=Ec({open:i=>this[Rn](t,i),close:i=>this[Rn](r,i),reopen:e.reopen})}get opened(){return this[D].opened}get opening(){return this[D].opening}get closed(){return this[D].closed}get closing(){return this[D].closing}get actives(){return this[D].actives}open(){const e=bi();return this[D].open(e),e.promise}close(e=!1){const t=bi();return this[D].close(e,t),t.promise}active(e){return this[D].active(e)}inactive(e,t,r){return this[D].inactive(e,t,r)}async _open(){}async _close(){}async[Rn](e,t){try{await e(),t()}catch(r){t(r)}}}Lt.exports=n=>new vi(n);Lt.exports.NanoresourcePromise=vi;const{EventEmitter:Sc}=ge.exports,Cc=Lt.exports,x=Symbol("nanoresource");class wi extends Sc{constructor(e={}){super();this[x]=Cc({open:e.open||this._open.bind(this),close:e.close||this._close.bind(this),reopen:e.reopen})}get opened(){return this[x].opened}get opening(){return this[x].opening}get closed(){return this[x].closed}get closing(){return this[x].closing}get actives(){return this[x].actives}async open(){await this[x].open(),this.emit("opened")}async close(e){await this[x].close(e),this.emit("closed")}active(e){return this[x].active(e)}inactive(e,t,r){return this[x].inactive(e,t,r)}async _open(){}async _close(){}}Ae.exports=n=>new wi(n);Ae.exports.NanoresourcePromise=wi;function Rc(n){try{return JSON.stringify(n)}catch{return'"[Circular]"'}}var Tc=Pc;function Pc(n,e,t){var r=t&&t.stringify||Rc,i=1;if(n===null&&(n=e[0],i=0),typeof n=="object"&&n!==null){var s=e.length+i;if(s===1)return n;var o=new Array(s);o[0]=r(n);for(var c=1;c<s;c++)o[c]=r(e[c]);return o.join(" ")}var a=e.length;if(a===0)return n;for(var u="",l="",h=1-i,f=0,_=n&&n.length||0,d=0;d<_;){if(n.charCodeAt(d)===37&&d+1<_){switch(n.charCodeAt(d+1)){case 100:if(h>=a||(f<d&&(l+=n.slice(f,d)),e[h]==null))break;l+=Number(e[h]),f=d=d+2;break;case 79:case 111:case 106:if(h>=a||(f<d&&(l+=n.slice(f,d)),e[h]===void 0))break;var m=typeof e[h];if(m==="string"){l+="'"+e[h]+"'",f=d+2,d++;break}if(m==="function"){l+=e[h].name||"<anonymous>",f=d+2,d++;break}l+=r(e[h]),f=d+2,d++;break;case 115:if(h>=a)break;f<d&&(l+=n.slice(f,d)),l+=String(e[h]),f=d+2,d++;break;case 37:f<d&&(l+=n.slice(f,d)),l+="%",f=d+2,d++;break}++h}++d}for(f===0?l=n:f<_&&(l+=n.slice(f));h<a;)u=e[h++],u===null||typeof u!="object"?l+=" "+String(u):l+=" "+r(u);return l}const Oc=Tc;class Ei extends Error{static get code(){return this.name}static equals(e){return e&&typeof e=="object"&&e.isNanoerror&&e.code===this.code}constructor(...e){super();const t=this.constructor.code,r=this.constructor.message;this.message=Oc(r,e),this.name=t,this.code=this.name,this.args=e,this.unformatMessage=r,typeof Error.captureStackTrace=="function"?Error.captureStackTrace(this,this.constructor):this.stack=new Error(this.message).stack}get isNanoerror(){return!0}}Ei.message="";function Ac(n,e="%s"){const t={[n]:class extends Ei{static from(r){const i=new t[n](`[${r.toString()}]`);return i.stack=r.stack||i.stack,i}}};return t[n].message=e,t[n]}var Mt=Ac;const kc=Mt,Si={};function fe(n,e){Si[n]=kc(n,e)}fe("NMSG_ERR_TIMEOUT","timeout on request: %s");fe("NMSG_ERR_ENCODE","error encoding the request: %s");fe("NMSG_ERR_DECODE","error decoding the request: %s");fe("NMSG_ERR_RESPONSE","response error on request: %s");fe("NMSG_ERR_CLOSE","nanomessage was closed");fe("NMSG_ERR_NOT_OPEN","nanomessage is not open");fe("NMSG_ERR_CANCEL","request canceled: %s");var It=Si;const{NMSG_ERR_CANCEL:Ci,NMSG_ERR_TIMEOUT:Nc}=It;class Tn{static info(e={}){return{id:e.id,data:e.data,response:e.response||!1,ephemeral:e.id===0}}constructor(e){const{id:t,data:r,response:i=!1,timeout:s,signal:o}=e;this.id=t,this.data=r,this.response=i,this.finished=!1,this.timeout=s,this.timer=null;let c,a;this.promise=new Promise((l,h)=>{c=l,a=h}),this.promise.cancel=this.cancel.bind(this);const u=()=>this.cancel();o&&(o.aborted?process.nextTick(u):o.addEventListener("abort",u)),this.resolve=l=>{this.finished||(this.timer&&clearTimeout(this.timer),o&&o.removeEventListener("abort",u),this.finished=!0,this._onFinish(),c(l))},this.reject=l=>{this.finished||(this.timer&&clearTimeout(this.timer),o&&o.removeEventListener("abort",u),this.finished=!0,this._onFinish(l),a(l))}}start(){this.timeout&&(this.timer=setTimeout(()=>{this.reject(new Nc(this.id))},this.timeout))}onFinish(e){this._onFinish=e}cancel(e){e?typeof e=="string"&&(e=new Ci(this.id,e)):e=new Ci(this.id),this.reject(e)}info(){return Tn.info(this)}}var Lc=Tn,Mc=Ti,Ri=128,Ic=127,Dc=~Ic,xc=Math.pow(2,31);function Ti(n,e,t){e=e||[],t=t||0;for(var r=t;n>=xc;)e[t++]=n&255|Ri,n/=128;for(;n&Dc;)e[t++]=n&255|Ri,n>>>=7;return e[t]=n|0,Ti.bytes=t-r+1,e}var Fc=Pn,qc=128,Pi=127;function Pn(n,e){var t=0,e=e||0,r=0,i=e,s,o=n.length;do{if(i>=o)throw Pn.bytes=0,new RangeError("Could not decode varint");s=n[i++],t+=r<28?(s&Pi)<<r:(s&Pi)*Math.pow(2,r),r+=7}while(s>=qc);return Pn.bytes=i-e,t}var jc=Math.pow(2,7),$c=Math.pow(2,14),Bc=Math.pow(2,21),Uc=Math.pow(2,28),Wc=Math.pow(2,35),Hc=Math.pow(2,42),Gc=Math.pow(2,49),Vc=Math.pow(2,56),zc=Math.pow(2,63),Qc=function(n){return n<jc?1:n<$c?2:n<Bc?3:n<Uc?4:n<Wc?5:n<Hc?6:n<Gc?7:n<Vc?8:n<zc?9:10},Oi={encode:Mc,decode:Fc,encodingLength:Qc};function Je(n,e){if(typeof n!="object")return e&&Object.prototype.toString.call(n)==="[object String]"&&n.startsWith("base64:")?Buffer.from(n.slice("base64:".length),"base64"):n;let t,r;const i=Object.prototype.toString.call(n);if(!e&&i==="[object Uint8Array]"&&Buffer.isBuffer(n))return"base64:"+Buffer.from(n).toString("base64");if(i==="[object Object]"){r={};for(t in n)r[t]=Je(n[t],e);return r}if(i==="[object Array]"){for(t=n.length,r=Array(t);t--;)r[t]=Je(n[t],e);return r}return n}var Ai={_lastObj:null,_lastStr:null,_lastLength:null,encode(n,e,t){let r,i;return this._lastObj===n?(r=this._lastStr,i=this._lastLength):(r=JSON.stringify(Je({data:n})),i=Buffer.byteLength(r,"utf8")),e.write(r,t,i,"utf8"),this._lastObj=null,this._lastStr=null,this._lastLength=null,e.slice(t,t+i)},decode(n,e,t){return e=e||0,t=t||n.length,Je(JSON.parse(n.slice(e,t)),!0).data},encodingLength(n){return this._lastObj=n,this._lastStr=JSON.stringify(Je({data:n})),this._lastLength=Buffer.byteLength(this._lastStr,"utf8"),this._lastLength}};const F=Oi,Yc=Ai,{NMSG_ERR_ENCODE:Kc,NMSG_ERR_DECODE:Jc}=It,ki=1;var Xc=function(e=Yc){return{encode(t){try{let r=t.id<<1;t.response&&(r=r|ki);const i=e.encodingLength(t.data),s=Buffer.allocUnsafe(F.encodingLength(r)+F.encodingLength(i)+i);let o=0;return F.encode(r,s,o),o+=F.encode.bytes,F.encode(i,s,o),o+=F.encode.bytes,e.encode(t.data,s,o),s}catch(r){throw new Kc(r.message)}},decode(t){try{const r={};let i=0;const s=F.decode(t,i);i+=F.decode.bytes;const o=F.decode(t,i);return i+=F.decode.bytes,r.data=e.decode(t,i,i+o),r.response=!!(s&ki),r.id=s>>1,r}catch(r){throw new Jc(r.message)}}}},Zc=class{constructor(e){this._generate=e,this._free=[]}get(){return this._free.length?this._free.pop():this._generate()}release(e){this._free.push(e)}};const{NanoresourcePromise:el}=Ae.exports,Ni=Pt.exports,On=Lc,tl=Xc,{NMSG_ERR_CLOSE:Li,NMSG_ERR_NOT_OPEN:nl,NMSG_ERR_RESPONSE:Mi}=It,rl=Zc,J=Symbol("nanomessage.requests"),X=Symbol("nanomessage.inqueue"),W=Symbol("nanomessage.outqueue"),An=Symbol("nanomessage.unsubscribe"),kn=Symbol("nanomessage.open"),Nn=Symbol("nanomessage.close"),Xe=Symbol("nanomessage.fastcheckopen"),Ln=Symbol("nanomessage.timeout"),Mn=Symbol("nanomessage.idgenerator"),Ne=Symbol("nanomessage.codec");function il(n,e){this[Xe]().then(()=>this._onMessage(n.data,n)).then(t=>this.closed||this.closing?e():(n.responseData=t,this._send(this[Ne].encode({id:n.id,response:n.response,data:t}),n))).then(()=>e()).catch(t=>e(t))}function sl(n,e){const t=n.info();this[Xe]().then(()=>{if(!n.finished)return n.start(),this._send(this[Ne].encode(t),t)}).then(()=>{if(!n.finished)return n.promise}).then(r=>e(null,r)).catch(r=>e(r))}class ol extends el{constructor(e={}){super();const{send:t,subscribe:r,onMessage:i,open:s,close:o,timeout:c,valueEncoding:a,concurrency:u=256}=e;t&&(this._send=t),r&&(this._subscribe=r),i&&this.setMessageHandler(i),s&&(this[kn]=s),o&&(this[Nn]=o),this.setRequestTimeout(c),this[Ne]=tl(a),this[X]=Ni(this,il,1),this[W]=Ni(this,sl,1),this.setConcurrency(u),this[J]=new Map,this[Mn]=new rl(()=>this[J].size+1)}get codec(){return this[Ne]}get requests(){return Array.from(this[J].values())}get inflightRequests(){return this[W].running()}get requestTimeout(){return this[Ln]}get concurrency(){return{incoming:this[X].concurrency,outgoing:this[W].concurrency}}setRequestTimeout(e){return this[Ln]=e,this}setConcurrency(e){return typeof e=="number"?(this[X].concurrency=e,this[W].concurrency=e):(this[X].concurrency=e.incoming||this[X].concurrency,this[W].concurrency=e.outgoing||this[W].concurrency),this}request(e,t={}){const r=new On({id:this[Mn].get(),data:e,timeout:t.timeout||this[Ln],signal:t.signal}),i=r.info();return this[J].set(r.id,r),r.onFinish(()=>{this[J].delete(r.id),this[Mn].release(r.id)}),this.emit("request-created",i),this[W].push(r,(s,o)=>{i.response=!0,i.responseData=o,this.emit("request-ended",s,i)}),r.promise}send(e){return this[Xe]().then(()=>{const t=On.info({id:0,data:e});return this._send(this[Ne].encode(t),t)})}setMessageHandler(e){return this._onMessage=e,this}processIncomingMessage(e){if(this.closed||this.closing)return;const t=On.info(this[Ne].decode(e));if(t.response){const r=this[J].get(t.id);r&&r.resolve(t.data);return}if(t.ephemeral){this.emit("request-received",t),this[Xe]().then(()=>this._onMessage(t.data,t)).catch(r=>{const i=new Mi(r.message);i.stack=r.stack||i.stack,this.emit("response-error",i,t)});return}t.response=!0,this.emit("request-received",t),this[X].push(t,r=>{if(r){const i=new Mi(r.message);i.stack=r.stack||i.stack,this.emit("response-error",i,t)}})}async _send(e,t){throw new Error("_send not implemented")}async _onMessage(e,t){throw new Error("_onMessage not implemented")}async _open(){await(this[kn]&&this[kn]()),this[An]=this._subscribe&&this._subscribe(this.processIncomingMessage.bind(this))}async _close(){this[An]&&this[An]();const e=[];this[J].forEach(t=>t.reject(new Li)),this[J].clear(),this[X]&&this[X].kill(),this[W]&&this[W].kill(),await(this[Nn]&&this[Nn]()),await Promise.all(e)}async[Xe](){if(this.closed||this.closing)throw new Li;if(this.opening)return this.open();if(!this.opened)throw new nl}}var al=ol;const Ii=al,Dt=n=>new Ii(n);Dt.Nanomessage=Ii;Dt.errors=It;Dt.BJSON=Ai;var Di=Dt,xt={};(function(n){const e=Mt;n.encodeError=i,n.decodeError=s;const t=new Map;function r(o,c){n[o]=e(o,c)}function i(o){return{error:!0,data:{code:o.code,unformatMessage:o.unformatMessage,args:o.args,stack:o.stack}}}function s(o,c){if(n[o])return n[o];if(t.has(o))return t.get(o);const a=e(o,c);return t.set(o,a),a}r("NRPC_ERR_NAME_MISSING","missing action handler for: %s"),r("NRPC_ERR_RESPONSE_ERROR","%s"),r("NRPC_ERR_REQUEST_CANCELED","%s"),r("NRPC_ERR_CLOSE","nanomessage-rpc was closed"),r("NRPC_ERR_NOT_OPEN","nanomessage-rpc is not open"),r("NRPC_ERR_ENCODE","error encoding the request: %s"),r("NRPC_ERR_DECODE","error decoding the request: %s")})(xt);const L=Oi,{BJSON:Ft}=Di,{NRPC_ERR_ENCODE:cl,NRPC_ERR_DECODE:ll}=xt;function qt(n,e){L.encode(n,e.buf,e.offset),e.offset+=L.encode.bytes}function xi(n,e,t,r){qt(e,r),n.encode(t,r.buf,r.offset),r.offset+=e}function ul(n,e,t){qt(e,t),t.buf.write(n,t.offset,e,"utf8"),t.offset+=e}function Fi(n){const e=L.decode(n.buf,n.offset);return n.offset+=L.decode.bytes,e}function qi(n,e){const t=Fi(e),r=n.decode(e.buf,e.offset,e.offset+t);return e.offset+=t,r}function hl(n){const e=Fi(n),t=n.buf.slice(n.offset,n.offset+e);return n.offset+=e,t}const ji=1,$i=1<<1,Bi=1<<2;class fl{constructor(e=Ft){this._valueEncoding=e,this._lastHeader=null,this._lastDataLength=null,this._lastNameLength=null}encode(e,t,r=0){try{return e.name?this._encodeRequest(e,t,r):this._encodeResponse(e,t,r)}catch(i){const s=new cl(i.message);throw s.stack=i.stack||s.stack,i}}decode(e,t=0){try{const r=L.decode(e,t);return t+=L.decode.bytes,r&ji?this._decodeResponse(r,e,t):this._decodeRequest(r,e,t)}catch(r){const i=new ll(r.message);throw i.stack=r.stack||i.stack,r}}encodingLength(e){return e.name?this._encodingLengthRequest(e):this._encodingLengthResponse(e)}_headerRequest(e){let t=0;return e.event&&(t=t|$i),this._lastHeader=t,t}_headerResponse(e){let t=0;return t=t|ji,e.error&&(t=t|Bi),this._lastHeader=t,t}_encodeRequest(e,t,r){const i={buf:t,offset:r};return qt(this._lastHeader,i),ul(e.name,this._lastNameLength,i),xi(this._valueEncoding,this._lastDataLength,e.data,i),i.buf}_decodeRequest(e,t,r){const i={},s={buf:t,offset:r};return i.event=!!(e&$i),i.name=hl(s).toString(),i.data=qi(this._valueEncoding,s),i}_encodingLengthRequest(e){const t=this._headerRequest(e);return this._lastDataLength=this._valueEncoding.encodingLength(e.data),this._lastNameLength=Buffer.byteLength(e.name,"utf8"),L.encodingLength(t)+L.encodingLength(this._lastDataLength)+this._lastDataLength+L.encodingLength(this._lastNameLength)+this._lastNameLength}_encodingLengthResponse(e){const t=this._headerResponse(e);let r=this._valueEncoding;e.error&&(r=Ft);const i=r.encodingLength(e.data);return L.encodingLength(t)+L.encodingLength(i)+i}_encodeResponse(e,t,r){let i=this._valueEncoding;e.error&&(i=Ft);const s=i.encodingLength(e.data),o={buf:t,offset:r};return qt(this._lastHeader,o),xi(i,s,e.data,o),o.buf}_decodeResponse(e,t,r){const i={},s={buf:t,offset:r};i.error=!!(e&Bi);let o=this._valueEncoding;return i.error&&(o=Ft),i.data=qi(o,s),i}}var dl=fl;const{EventEmitter:pl}=ge.exports,_l=wc,gl=Di,In=me,{NanoresourcePromise:ml}=Lt.exports,yl=dl,{encodeError:Dn,decodeError:bl,NRPC_ERR_NAME_MISSING:vl,NRPC_ERR_RESPONSE_ERROR:wl,NRPC_ERR_CLOSE:El,NRPC_ERR_NOT_OPEN:Sl,NRPC_ERR_REQUEST_CANCELED:Ui}=xt,M=Symbol("nrpc.nanomessage"),Wi=Symbol("nrpc.onmessage"),Hi=Symbol("nrpc.subscribe"),xn=Symbol("nrpc.actions"),Le=Symbol("nrpc.emittery"),Fn=Symbol("nrpc.fastcheckopen"),qn=Symbol("nrpc.createrequest"),Gi=()=>{};class Cl extends ml{constructor(e={}){super();const u=e,{onError:t=()=>{},valueEncoding:r,send:i,subscribe:s,open:o=Gi,close:c=Gi}=u,a=te(u,["onError","valueEncoding","send","subscribe","open","close"]);In(i,"send is required"),In(s,"subscribe is required"),this.ee=new pl,this[M]=gl(q(R({},a),{send:i.bind(this),open:o.bind(this),close:c.bind(this),onMessage:this[Wi].bind(this),subscribe:this[Hi](s),valueEncoding:new yl(r)})),this[Le]=new _l,this[xn]=new Map,this._onError=t,this.ee.on("error",l=>{this._onError(l)})}get requests(){return this[M].requests}get inflightRequests(){return this[M].inflightRequests}get requestTimeout(){return this[M].timeout}get concurrency(){return this[M].concurrency}setRequestsTimeout(e){this[M].setRequestsTimeout(e)}setConcurrency(e){this[M].setConcurrency(e)}onError(e){this._onError=e}action(e,t){return this[xn].set(e,t),this}actions(e){return Object.keys(e).forEach(t=>this.action(t,e[t])),this}call(e,t,r={}){return this[qn]({name:e,data:t},r)}emit(e,t,r={}){return this[qn]({name:e,data:t,event:!0},r)}on(...e){return this[Le].on(...e)}once(...e){return this[Le].once(...e)}off(...e){return this[Le].off(...e)}events(e){return this[Le].events(e)}async _open(){await this[M].open(),this.ee.emit("opened")}async _close(){await this[M].close(),this.ee.emit("closed")}async[Fn](){if(this.closed||this.closing)throw new El;if(this.opening)return this.open();if(!this.opened)throw new Sl}[Hi](e){return t=>{e(r=>{try{t(r)}catch(i){process.nextTick(()=>this.ee.emit("error",i))}})}}[qn](e,{timeout:t,signal:r,wait:i=!0}){if(In(e.name&&typeof e.name=="string","name is required"),e.event&&!i)return this[Fn]().then(()=>this[M].send(e));let s,o;const c=this[Fn]().then(()=>{if(s)throw s;return o=this[M].request(e,{timeout:t,signal:r}),this.ee.emit("request-created",o,e),o}).then(a=>{if(a.error){const{code:u,unformatMessage:l,args:h,stack:f}=a.data,_=bl(u,l),d=new _(...h);throw d.stack=f||d.stack,d}else return a.data});return c.cancel=a=>{if(a?typeof a=="string"&&(s=new Ui(a)):s=new Ui("request canceled"),o)return o.cancel(s);s=a},c}async[Wi](e){this.ee.emit("message",e);try{if(e.event)return await this[Le].emit(e.name,e.data),{data:null};const t=this[xn].get(e.name);return t?{data:await t(e.data)}:Dn(new vl(e.name))}catch(t){if(t.isNanoerror)return Dn(t);const r=new wl(t.message);return r.stack=t.stack||r.stack,Dn(r)}}}var Rl=Cl;const Vi=lt;function Tl(n,e=!0){return{send(t){n.destroyed||n.write(t)},subscribe(t){return n.on("data",t),()=>n.removeListener("data",t)},open(){Vi(n,()=>{this.close().catch(t=>process.nextTick(()=>this.ee.emit("error",t)))})},close(){return new Promise(t=>{if(n.destroyed||!e)return t();Vi(n,()=>t()),n.destroy()})}}}var Pl=Tl;const zi=Rl;Pe.exports=(...n)=>new zi(...n);Pe.exports.NanomessageRPC=zi;Pe.exports.useSocket=Pl;Pe.exports.errors=xt;var Ol=function(){if(typeof globalThis=="undefined")return null;var e={RTCPeerConnection:globalThis.RTCPeerConnection||globalThis.mozRTCPeerConnection||globalThis.webkitRTCPeerConnection,RTCSessionDescription:globalThis.RTCSessionDescription||globalThis.mozRTCSessionDescription||globalThis.webkitRTCSessionDescription,RTCIceCandidate:globalThis.RTCIceCandidate||globalThis.mozRTCIceCandidate||globalThis.webkitRTCIceCandidate};return e.RTCPeerConnection?e:null};function Qi(n,e){for(const t in e)Object.defineProperty(n,t,{value:e[t],enumerable:!0,configurable:!0});return n}function Al(n,e,t){if(!n||typeof n=="string")throw new TypeError("Please pass an Error to err-code");t||(t={}),typeof e=="object"&&(t=e,e=""),e&&(t.code=e);try{return Qi(n,t)}catch{t.message=n.message,t.stack=n.stack;const i=function(){};return i.prototype=Object.create(Object.getPrototypeOf(n)),Qi(new i,t)}}var kl=Al;/*! simple-peer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */const Nl=j.exports("simple-peer"),Yi=Ol,Ki=ft.exports,Ll=_t.exports,jn=Yr,b=kl,{Buffer:Ml}=Fe,$n=64*1024,Il=5*1e3,Dl=5*1e3;function Ji(n){return n.replace(/a=ice-options:trickle\s\n/g,"")}function xl(n){console.warn(n)}class de extends Ll.Duplex{constructor(e){e=Object.assign({allowHalfOpen:!1},e);super(e);if(this._id=Ki(4).toString("hex").slice(0,7),this._debug("new peer %o",e),this.channelName=e.initiator?e.channelName||Ki(20).toString("hex"):null,this.initiator=e.initiator||!1,this.channelConfig=e.channelConfig||de.channelConfig,this.channelNegotiated=this.channelConfig.negotiated,this.config=Object.assign({},de.config,e.config),this.offerOptions=e.offerOptions||{},this.answerOptions=e.answerOptions||{},this.sdpTransform=e.sdpTransform||(t=>t),this.streams=e.streams||(e.stream?[e.stream]:[]),this.trickle=e.trickle!==void 0?e.trickle:!0,this.allowHalfTrickle=e.allowHalfTrickle!==void 0?e.allowHalfTrickle:!1,this.iceCompleteTimeout=e.iceCompleteTimeout||Il,this.destroyed=!1,this.destroying=!1,this._connected=!1,this.remoteAddress=void 0,this.remoteFamily=void 0,this.remotePort=void 0,this.localAddress=void 0,this.localFamily=void 0,this.localPort=void 0,this._wrtc=e.wrtc&&typeof e.wrtc=="object"?e.wrtc:Yi(),!this._wrtc)throw b(typeof window=="undefined"?new Error("No WebRTC support: Specify `opts.wrtc` option in this environment"):new Error("No WebRTC support: Not a supported browser"),"ERR_WEBRTC_SUPPORT");this._pcReady=!1,this._channelReady=!1,this._iceComplete=!1,this._iceCompleteTimer=null,this._channel=null,this._pendingCandidates=[],this._isNegotiating=!1,this._firstNegotiation=!0,this._batchedNegotiation=!1,this._queuedNegotiation=!1,this._sendersAwaitingStable=[],this._senderMap=new Map,this._closingInterval=null,this._remoteTracks=[],this._remoteStreams=[],this._chunk=null,this._cb=null,this._interval=null;try{this._pc=new this._wrtc.RTCPeerConnection(this.config)}catch(t){this.destroy(b(t,"ERR_PC_CONSTRUCTOR"));return}this._isReactNativeWebrtc=typeof this._pc._peerConnectionId=="number",this._pc.oniceconnectionstatechange=()=>{this._onIceStateChange()},this._pc.onicegatheringstatechange=()=>{this._onIceStateChange()},this._pc.onconnectionstatechange=()=>{this._onConnectionStateChange()},this._pc.onsignalingstatechange=()=>{this._onSignalingStateChange()},this._pc.onicecandidate=t=>{this._onIceCandidate(t)},typeof this._pc.peerIdentity=="object"&&this._pc.peerIdentity.catch(t=>{this.destroy(b(t,"ERR_PC_PEER_IDENTITY"))}),this.initiator||this.channelNegotiated?this._setupData({channel:this._pc.createDataChannel(this.channelName,this.channelConfig)}):this._pc.ondatachannel=t=>{this._setupData(t)},this.streams&&this.streams.forEach(t=>{this.addStream(t)}),this._pc.ontrack=t=>{this._onTrack(t)},this._debug("initial negotiation"),this._needsNegotiation(),this._onFinishBound=()=>{this._onFinish()},this.once("finish",this._onFinishBound)}get bufferSize(){return this._channel&&this._channel.bufferedAmount||0}get connected(){return this._connected&&this._channel.readyState==="open"}address(){return{port:this.localPort,family:this.localFamily,address:this.localAddress}}signal(e){if(!this.destroying){if(this.destroyed)throw b(new Error("cannot signal after peer is destroyed"),"ERR_DESTROYED");if(typeof e=="string")try{e=JSON.parse(e)}catch{e={}}this._debug("signal()"),e.renegotiate&&this.initiator&&(this._debug("got request to renegotiate"),this._needsNegotiation()),e.transceiverRequest&&this.initiator&&(this._debug("got request for transceiver"),this.addTransceiver(e.transceiverRequest.kind,e.transceiverRequest.init)),e.candidate&&(this._pc.remoteDescription&&this._pc.remoteDescription.type?this._addIceCandidate(e.candidate):this._pendingCandidates.push(e.candidate)),e.sdp&&this._pc.setRemoteDescription(new this._wrtc.RTCSessionDescription(e)).then(()=>{this.destroyed||(this._pendingCandidates.forEach(t=>{this._addIceCandidate(t)}),this._pendingCandidates=[],this._pc.remoteDescription.type==="offer"&&this._createAnswer())}).catch(t=>{this.destroy(b(t,"ERR_SET_REMOTE_DESCRIPTION"))}),!e.sdp&&!e.candidate&&!e.renegotiate&&!e.transceiverRequest&&this.destroy(b(new Error("signal() called with invalid signal data"),"ERR_SIGNALING"))}}_addIceCandidate(e){const t=new this._wrtc.RTCIceCandidate(e);this._pc.addIceCandidate(t).catch(r=>{!t.address||t.address.endsWith(".local")?xl("Ignoring unsupported ICE candidate."):this.destroy(b(r,"ERR_ADD_ICE_CANDIDATE"))})}send(e){if(!this.destroying){if(this.destroyed)throw b(new Error("cannot send after peer is destroyed"),"ERR_DESTROYED");this._channel.send(e)}}addTransceiver(e,t){if(!this.destroying){if(this.destroyed)throw b(new Error("cannot addTransceiver after peer is destroyed"),"ERR_DESTROYED");if(this._debug("addTransceiver()"),this.initiator)try{this._pc.addTransceiver(e,t),this._needsNegotiation()}catch(r){this.destroy(b(r,"ERR_ADD_TRANSCEIVER"))}else this.emit("signal",{type:"transceiverRequest",transceiverRequest:{kind:e,init:t}})}}addStream(e){if(!this.destroying){if(this.destroyed)throw b(new Error("cannot addStream after peer is destroyed"),"ERR_DESTROYED");this._debug("addStream()"),e.getTracks().forEach(t=>{this.addTrack(t,e)})}}addTrack(e,t){if(this.destroying)return;if(this.destroyed)throw b(new Error("cannot addTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("addTrack()");const r=this._senderMap.get(e)||new Map;let i=r.get(t);if(!i)i=this._pc.addTrack(e,t),r.set(t,i),this._senderMap.set(e,r),this._needsNegotiation();else throw i.removed?b(new Error("Track has been removed. You should enable/disable tracks that you want to re-add."),"ERR_SENDER_REMOVED"):b(new Error("Track has already been added to that stream."),"ERR_SENDER_ALREADY_ADDED")}replaceTrack(e,t,r){if(this.destroying)return;if(this.destroyed)throw b(new Error("cannot replaceTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("replaceTrack()");const i=this._senderMap.get(e),s=i?i.get(r):null;if(!s)throw b(new Error("Cannot replace track that was never added."),"ERR_TRACK_NOT_ADDED");t&&this._senderMap.set(t,i),s.replaceTrack!=null?s.replaceTrack(t):this.destroy(b(new Error("replaceTrack is not supported in this browser"),"ERR_UNSUPPORTED_REPLACETRACK"))}removeTrack(e,t){if(this.destroying)return;if(this.destroyed)throw b(new Error("cannot removeTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("removeSender()");const r=this._senderMap.get(e),i=r?r.get(t):null;if(!i)throw b(new Error("Cannot remove track that was never added."),"ERR_TRACK_NOT_ADDED");try{i.removed=!0,this._pc.removeTrack(i)}catch(s){s.name==="NS_ERROR_UNEXPECTED"?this._sendersAwaitingStable.push(i):this.destroy(b(s,"ERR_REMOVE_TRACK"))}this._needsNegotiation()}removeStream(e){if(!this.destroying){if(this.destroyed)throw b(new Error("cannot removeStream after peer is destroyed"),"ERR_DESTROYED");this._debug("removeSenders()"),e.getTracks().forEach(t=>{this.removeTrack(t,e)})}}_needsNegotiation(){this._debug("_needsNegotiation"),!this._batchedNegotiation&&(this._batchedNegotiation=!0,jn(()=>{this._batchedNegotiation=!1,this.initiator||!this._firstNegotiation?(this._debug("starting batched negotiation"),this.negotiate()):this._debug("non-initiator initial negotiation request discarded"),this._firstNegotiation=!1}))}negotiate(){if(!this.destroying){if(this.destroyed)throw b(new Error("cannot negotiate after peer is destroyed"),"ERR_DESTROYED");this.initiator?this._isNegotiating?(this._queuedNegotiation=!0,this._debug("already negotiating, queueing")):(this._debug("start negotiation"),setTimeout(()=>{this._createOffer()},0)):this._isNegotiating?(this._queuedNegotiation=!0,this._debug("already negotiating, queueing")):(this._debug("requesting negotiation from initiator"),this.emit("signal",{type:"renegotiate",renegotiate:!0})),this._isNegotiating=!0}}destroy(e){this._destroy(e,()=>{})}_destroy(e,t){this.destroyed||this.destroying||(this.destroying=!0,this._debug("destroying (error: %s)",e&&(e.message||e)),jn(()=>{if(this.destroyed=!0,this.destroying=!1,this._debug("destroy (error: %s)",e&&(e.message||e)),this.readable=this.writable=!1,this._readableState.ended||this.push(null),this._writableState.finished||this.end(),this._connected=!1,this._pcReady=!1,this._channelReady=!1,this._remoteTracks=null,this._remoteStreams=null,this._senderMap=null,clearInterval(this._closingInterval),this._closingInterval=null,clearInterval(this._interval),this._interval=null,this._chunk=null,this._cb=null,this._onFinishBound&&this.removeListener("finish",this._onFinishBound),this._onFinishBound=null,this._channel){try{this._channel.close()}catch{}this._channel.onmessage=null,this._channel.onopen=null,this._channel.onclose=null,this._channel.onerror=null}if(this._pc){try{this._pc.close()}catch{}this._pc.oniceconnectionstatechange=null,this._pc.onicegatheringstatechange=null,this._pc.onsignalingstatechange=null,this._pc.onicecandidate=null,this._pc.ontrack=null,this._pc.ondatachannel=null}this._pc=null,this._channel=null,e&&this.emit("error",e),this.emit("close"),t()}))}_setupData(e){if(!e.channel)return this.destroy(b(new Error("Data channel event is missing `channel` property"),"ERR_DATA_CHANNEL"));this._channel=e.channel,this._channel.binaryType="arraybuffer",typeof this._channel.bufferedAmountLowThreshold=="number"&&(this._channel.bufferedAmountLowThreshold=$n),this.channelName=this._channel.label,this._channel.onmessage=r=>{this._onChannelMessage(r)},this._channel.onbufferedamountlow=()=>{this._onChannelBufferedAmountLow()},this._channel.onopen=()=>{this._onChannelOpen()},this._channel.onclose=()=>{this._onChannelClose()},this._channel.onerror=r=>{const i=r.error instanceof Error?r.error:new Error(`Datachannel error: ${r.message} ${r.filename}:${r.lineno}:${r.colno}`);this.destroy(b(i,"ERR_DATA_CHANNEL"))};let t=!1;this._closingInterval=setInterval(()=>{this._channel&&this._channel.readyState==="closing"?(t&&this._onChannelClose(),t=!0):t=!1},Dl)}_read(){}_write(e,t,r){if(this.destroyed)return r(b(new Error("cannot write after peer is destroyed"),"ERR_DATA_CHANNEL"));if(this._connected){try{this.send(e)}catch(i){return this.destroy(b(i,"ERR_DATA_CHANNEL"))}this._channel.bufferedAmount>$n?(this._debug("start backpressure: bufferedAmount %d",this._channel.bufferedAmount),this._cb=r):r(null)}else this._debug("write before connect"),this._chunk=e,this._cb=r}_onFinish(){if(this.destroyed)return;const e=()=>{setTimeout(()=>this.destroy(),1e3)};this._connected?e():this.once("connect",e)}_startIceCompleteTimeout(){this.destroyed||this._iceCompleteTimer||(this._debug("started iceComplete timeout"),this._iceCompleteTimer=setTimeout(()=>{this._iceComplete||(this._iceComplete=!0,this._debug("iceComplete timeout completed"),this.emit("iceTimeout"),this.emit("_iceComplete"))},this.iceCompleteTimeout))}_createOffer(){this.destroyed||this._pc.createOffer(this.offerOptions).then(e=>{if(this.destroyed)return;!this.trickle&&!this.allowHalfTrickle&&(e.sdp=Ji(e.sdp)),e.sdp=this.sdpTransform(e.sdp);const t=()=>{if(this.destroyed)return;const s=this._pc.localDescription||e;this._debug("signal"),this.emit("signal",{type:s.type,sdp:s.sdp})},r=()=>{this._debug("createOffer success"),!this.destroyed&&(this.trickle||this._iceComplete?t():this.once("_iceComplete",t))},i=s=>{this.destroy(b(s,"ERR_SET_LOCAL_DESCRIPTION"))};this._pc.setLocalDescription(e).then(r).catch(i)}).catch(e=>{this.destroy(b(e,"ERR_CREATE_OFFER"))})}_requestMissingTransceivers(){this._pc.getTransceivers&&this._pc.getTransceivers().forEach(e=>{!e.mid&&e.sender.track&&!e.requested&&(e.requested=!0,this.addTransceiver(e.sender.track.kind))})}_createAnswer(){this.destroyed||this._pc.createAnswer(this.answerOptions).then(e=>{if(this.destroyed)return;!this.trickle&&!this.allowHalfTrickle&&(e.sdp=Ji(e.sdp)),e.sdp=this.sdpTransform(e.sdp);const t=()=>{if(this.destroyed)return;const s=this._pc.localDescription||e;this._debug("signal"),this.emit("signal",{type:s.type,sdp:s.sdp}),this.initiator||this._requestMissingTransceivers()},r=()=>{this.destroyed||(this.trickle||this._iceComplete?t():this.once("_iceComplete",t))},i=s=>{this.destroy(b(s,"ERR_SET_LOCAL_DESCRIPTION"))};this._pc.setLocalDescription(e).then(r).catch(i)}).catch(e=>{this.destroy(b(e,"ERR_CREATE_ANSWER"))})}_onConnectionStateChange(){this.destroyed||this._pc.connectionState==="failed"&&this.destroy(b(new Error("Connection failed."),"ERR_CONNECTION_FAILURE"))}_onIceStateChange(){if(this.destroyed)return;const e=this._pc.iceConnectionState,t=this._pc.iceGatheringState;this._debug("iceStateChange (connection: %s) (gathering: %s)",e,t),this.emit("iceStateChange",e,t),(e==="connected"||e==="completed")&&(this._pcReady=!0,this._maybeReady()),e==="failed"&&this.destroy(b(new Error("Ice connection failed."),"ERR_ICE_CONNECTION_FAILURE")),e==="closed"&&this.destroy(b(new Error("Ice connection closed."),"ERR_ICE_CONNECTION_CLOSED"))}getStats(e){const t=r=>(Object.prototype.toString.call(r.values)==="[object Array]"&&r.values.forEach(i=>{Object.assign(r,i)}),r);this._pc.getStats.length===0||this._isReactNativeWebrtc?this._pc.getStats().then(r=>{const i=[];r.forEach(s=>{i.push(t(s))}),e(null,i)},r=>e(r)):this._pc.getStats.length>0?this._pc.getStats(r=>{if(this.destroyed)return;const i=[];r.result().forEach(s=>{const o={};s.names().forEach(c=>{o[c]=s.stat(c)}),o.id=s.id,o.type=s.type,o.timestamp=s.timestamp,i.push(t(o))}),e(null,i)},r=>e(r)):e(null,[])}_maybeReady(){if(this._debug("maybeReady pc %s channel %s",this._pcReady,this._channelReady),this._connected||this._connecting||!this._pcReady||!this._channelReady)return;this._connecting=!0;const e=()=>{this.destroyed||this.getStats((t,r)=>{if(this.destroyed)return;t&&(r=[]);const i={},s={},o={};let c=!1;r.forEach(u=>{(u.type==="remotecandidate"||u.type==="remote-candidate")&&(i[u.id]=u),(u.type==="localcandidate"||u.type==="local-candidate")&&(s[u.id]=u),(u.type==="candidatepair"||u.type==="candidate-pair")&&(o[u.id]=u)});const a=u=>{c=!0;let l=s[u.localCandidateId];l&&(l.ip||l.address)?(this.localAddress=l.ip||l.address,this.localPort=Number(l.port)):l&&l.ipAddress?(this.localAddress=l.ipAddress,this.localPort=Number(l.portNumber)):typeof u.googLocalAddress=="string"&&(l=u.googLocalAddress.split(":"),this.localAddress=l[0],this.localPort=Number(l[1])),this.localAddress&&(this.localFamily=this.localAddress.includes(":")?"IPv6":"IPv4");let h=i[u.remoteCandidateId];h&&(h.ip||h.address)?(this.remoteAddress=h.ip||h.address,this.remotePort=Number(h.port)):h&&h.ipAddress?(this.remoteAddress=h.ipAddress,this.remotePort=Number(h.portNumber)):typeof u.googRemoteAddress=="string"&&(h=u.googRemoteAddress.split(":"),this.remoteAddress=h[0],this.remotePort=Number(h[1])),this.remoteAddress&&(this.remoteFamily=this.remoteAddress.includes(":")?"IPv6":"IPv4"),this._debug("connect local: %s:%s remote: %s:%s",this.localAddress,this.localPort,this.remoteAddress,this.remotePort)};if(r.forEach(u=>{u.type==="transport"&&u.selectedCandidatePairId&&a(o[u.selectedCandidatePairId]),(u.type==="googCandidatePair"&&u.googActiveConnection==="true"||(u.type==="candidatepair"||u.type==="candidate-pair")&&u.selected)&&a(u)}),!c&&(!Object.keys(o).length||Object.keys(s).length)){setTimeout(e,100);return}else this._connecting=!1,this._connected=!0;if(this._chunk){try{this.send(this._chunk)}catch(l){return this.destroy(b(l,"ERR_DATA_CHANNEL"))}this._chunk=null,this._debug('sent chunk from "write before connect"');const u=this._cb;this._cb=null,u(null)}typeof this._channel.bufferedAmountLowThreshold!="number"&&(this._interval=setInterval(()=>this._onInterval(),150),this._interval.unref&&this._interval.unref()),this._debug("connect"),this.emit("connect")})};e()}_onInterval(){!this._cb||!this._channel||this._channel.bufferedAmount>$n||this._onChannelBufferedAmountLow()}_onSignalingStateChange(){this.destroyed||(this._pc.signalingState==="stable"&&(this._isNegotiating=!1,this._debug("flushing sender queue",this._sendersAwaitingStable),this._sendersAwaitingStable.forEach(e=>{this._pc.removeTrack(e),this._queuedNegotiation=!0}),this._sendersAwaitingStable=[],this._queuedNegotiation?(this._debug("flushing negotiation queue"),this._queuedNegotiation=!1,this._needsNegotiation()):(this._debug("negotiated"),this.emit("negotiated"))),this._debug("signalingStateChange %s",this._pc.signalingState),this.emit("signalingStateChange",this._pc.signalingState))}_onIceCandidate(e){this.destroyed||(e.candidate&&this.trickle?this.emit("signal",{type:"candidate",candidate:{candidate:e.candidate.candidate,sdpMLineIndex:e.candidate.sdpMLineIndex,sdpMid:e.candidate.sdpMid}}):!e.candidate&&!this._iceComplete&&(this._iceComplete=!0,this.emit("_iceComplete")),e.candidate&&this._startIceCompleteTimeout())}_onChannelMessage(e){if(this.destroyed)return;let t=e.data;t instanceof ArrayBuffer&&(t=Ml.from(t)),this.push(t)}_onChannelBufferedAmountLow(){if(this.destroyed||!this._cb)return;this._debug("ending backpressure: bufferedAmount %d",this._channel.bufferedAmount);const e=this._cb;this._cb=null,e(null)}_onChannelOpen(){this._connected||this.destroyed||(this._debug("on channel open"),this._channelReady=!0,this._maybeReady())}_onChannelClose(){this.destroyed||(this._debug("on channel close"),this.destroy())}_onTrack(e){this.destroyed||e.streams.forEach(t=>{this._debug("on track"),this.emit("track",e.track,t),this._remoteTracks.push({track:e.track,stream:t}),!this._remoteStreams.some(r=>r.id===t.id)&&(this._remoteStreams.push(t),jn(()=>{this._debug("on stream"),this.emit("stream",t)}))})}_debug(){const e=[].slice.call(arguments);e[0]="["+this._id+"] "+e[0],Nl.apply(null,e)}}de.WEBRTC_SUPPORT=!!Yi();de.config={iceServers:[{urls:["stun:stun.l.google.com:19302","stun:global.stun.twilio.com:3478"]}],sdpSemantics:"unified-plan"};de.channelConfig={};var Fl=de;class ql{constructor(e){this.value=e,this.next=void 0}}class jl{constructor(){this.clear()}enqueue(e){const t=new ql(e);this._head?(this._tail.next=t,this._tail=t):(this._head=t,this._tail=t),this._size++}dequeue(){const e=this._head;if(!!e)return this._head=this._head.next,this._size--,e.value}clear(){this._head=void 0,this._tail=void 0,this._size=0}get size(){return this._size}*[Symbol.iterator](){let e=this._head;for(;e;)yield e.value,e=e.next}}var $l=jl;const Bl=$l,Ul=n=>{if(!((Number.isInteger(n)||n===1/0)&&n>0))throw new TypeError("Expected `concurrency` to be a number from 1 and up");const e=new Bl;let t=0;const r=()=>{t--,e.size>0&&e.dequeue()()},i=async(c,a,...u)=>{t++;const l=(async()=>c(...u))();a(l);try{await l}catch{}r()},s=(c,a,...u)=>{e.enqueue(i.bind(null,c,a,...u)),(async()=>{await Promise.resolve(),t<n&&e.size>0&&e.dequeue()()})()},o=(c,...a)=>new Promise(u=>{s(c,u,...a)});return Object.defineProperties(o,{activeCount:{get:()=>t},pendingCount:{get:()=>e.size},clearQueue:{value:()=>{e.clear()}}}),o};var Wl=Ul;const Hl=Wl;class Gl{constructor(){this._limit=Hl(1),this._cache=[]}onSignal(e){return this._onSignal=(t,r,i)=>e&&e(t,r,i),this}onClose(e){return this._onClose=t=>e&&e(t),this}resolution(e){this._resolution=()=>e&&e()}add(e){this._cache.push(e),this._limit(async()=>{if(this._limit.clearQueue(),this._cache.length===0||this._resolution())return;let t,r=300;do t=this._cache.length,await new Promise(s=>setTimeout(s,r)),r=1;while(t<this._cache.length&&this._cache.length<4);const i=this._cache;return this._cache=[],this._onSignal(i)}).catch(t=>{this._limit.clearQueue(),this._onClose(t)}).finally(()=>{this._resolution()&&(this._limit.clearQueue(),this._onClose())})}}var Xi=Gl,jt={};(function(n){const e=Mt;function t(r,i){n[r]=e(r,i)}t("ERR_ARGUMENT_INVALID","%s"),t("ERR_PEER_NOT_FOUND","peer not found: %s"),t("ERR_CONNECTION_CLOSED"),t("ERR_SIGNAL_TIMEOUT","Timeout trying to establish a connection. SIGNALS: %j")})(jt);const{NanoresourcePromise:Vl}=Ae.exports,zl=Fl,H=me,Ql=ae.exports,Yl=lt,Kl=Xi,{ERR_CONNECTION_CLOSED:Jl,ERR_SIGNAL_TIMEOUT:Xl}=jt,Ze=Symbol("peer.metadata"),et=Symbol("peer.localmetadata"),Zi=Symbol("peer.onsignal"),$t=Symbol("peer.offer");var es=class extends Vl{constructor(e={}){super();const{onSignal:t,initiator:r,sessionId:i,id:s,topic:o,metadata:c,localMetadata:a,simplePeer:u={},timeout:l}=e;H(t),H(r!==void 0,"initiator is required"),H(Buffer.isBuffer(i)&&i.length===32,"sessionId is required and must be a buffer of 32"),H(Buffer.isBuffer(s)&&s.length===32,"id is required and must be a buffer of 32"),H(Buffer.isBuffer(o)&&o.length===32,"topic must be a buffer of 32"),H(!c||typeof c=="object","metadata must be an object"),H(!a||typeof a=="object","localMetadata must be an object"),this.initiator=r,this.sessionId=i,this.id=s,this.topic=o,this.simplePeerOptions=u,this.timeout=l,this.subscribeMediaStream=!1,this.error=null,this.signals=[],this[Zi]=t,this[$t]=null,this[Ze]=c,this[et]=a,this.once("error",h=>{this.error=h}),this._initializeSimplePeer()}get connected(){return this.stream.connected}get destroyed(){return this.stream.destroyed}get metadata(){return this[Ze]}set metadata(e){return H(!e||typeof e=="object","metadata must be an object"),this[Ze]=e,this.emit("metadata-updated",this[Ze]),this[Ze]}get localMetadata(){return this[et]}set localMetadata(e){return H(!e||typeof e=="object","localMetadata must be an object"),this[et]=e,this.emit("local-metadata-updated",this[et]),this[et]}async ready(){if(!this.connected){if(this.destroyed)throw this.error?this.error:new Jl;return Ql(this,"connect",{rejectionEvents:["error","close"]})}}addStream(e){return this.ready().then(()=>this.stream.addStream(e))}removeStream(e){return this.ready().then(()=>this.stream.removeStream(e))}destroy(e){this.stream.destroy(e)}open(e){return e&&(this[$t]=e),super.open()}async _open(){const e=setTimeout(()=>{this.destroy(new Xl(this.signals))},this.timeout),t=new Kl,r=this.ready(),i=o=>t.add(o),s=()=>this.stream.removeListener("signal",i);return this.once("close",()=>s()),t.onSignal(o=>(this.signals=[...this.signals,...o],this[Zi](this,o))).onClose(o=>{s(),o&&process.nextTick(()=>this.destroy(o))}).resolution(()=>this.destroyed),this.stream.on("signal",i),!this.initiator&&this[$t]&&this[$t].forEach(o=>this.stream.signal(o)),r.finally(()=>{clearTimeout(e)})}_close(){if(!this.destroyed)return process.nextTick(()=>this.stream.destroy()),new Promise(e=>Yl(this.stream,()=>e()))}_initializeSimplePeer(){const a=this.simplePeerOptions,{streams:e=[]}=a,t=te(a,["streams"]);this.stream=new zl(q(R({},t),{initiator:this.initiator})),e.forEach(u=>this.addStream(u).catch(()=>{})),this.stream.close=()=>process.nextTick(()=>this.stream.destroy());const r=u=>this.emit("stream",u),i=u=>this.emit("signal",u),s=u=>this.emit("error",u),o=()=>this.emit("connect"),c=()=>{this.stream.removeListener("stream",r),this.stream.removeListener("signal",i),this.stream.removeListener("error",s),this.stream.removeListener("connect",o),this.close().catch(()=>{}),this.emit("close")};this.stream.on("stream",r),this.stream.on("signal",i),this.stream.once("error",s),this.stream.once("connect",o),this.stream.once("close",c)}};const ts=G,Z=me,Zl=Pt.exports,eu=ae.exports,ns=Pe.exports,{NanoresourcePromise:tu}=Ae.exports,rs=es,Bn=Symbol("socketsignal.connectionsqueue"),tt=Symbol("socketsignal.peers"),is=Symbol("socketsignal.defineactions"),ss=Symbol("socketsignal.defineevents"),Un=Symbol("socketsignal.addpeer"),Wn=Symbol("socketsignal.createpeer"),os=Symbol("socketsignal.onsignal");function nu({peer:n,data:e},t){this.open().then(()=>(this.emit("peer-connecting",n),n.open(e))).then(()=>t()).catch(r=>t(r))}class ru extends tu{constructor(e,t={}){super();const{id:r=ts.randomBytes(32),requestTimeout:i=15*1e3,queueConcurrency:s=4,simplePeer:o={},metadata:c}=t;Z(!c||typeof c=="object","metadata must be an object"),this.socket=e,this.rpc=ns(R({timeout:i},ns.useSocket(e))),this.id=r,this.metadata=c,this.simplePeer=o,this.requestTimeout=i,this[tt]=new Map,this[Bn]=Zl(this,nu,s),this[is](),this[ss]()}get peers(){return Array.from(this[tt].values())}get peersConnected(){return this.peers.filter(e=>e.connected)}get peersConnecting(){return this.peers.filter(e=>!e.connected)}getPeersByTopic(e){return Z(Buffer.isBuffer(e),"topic is required"),this.peers.filter(t=>t.topic.equals(e))}async join(e){Z(Buffer.isBuffer(e)&&e.length===32,"topic must be a Buffer of 32 bytes"),await this.open();const t=await this.rpc.call("join",this._buildMessage({topic:e}));return this.emit("join",e,t),t}async leave(e){Z(!e||Buffer.isBuffer(e)&&e.length===32,"topic must be a Buffer of 32 bytes"),await this.open(),await this.rpc.call("leave",this._buildMessage({topic:e})),this.emit("leave",e)}async lookup(e){Z(Buffer.isBuffer(e)&&e.length===32,"topic must be a Buffer of 32 bytes"),await this.open();const t=await this.rpc.call("lookup",this._buildMessage({topic:e}));return this.emit("lookup",e,t),t}connect(e,t,r={}){Z(Buffer.isBuffer(e)&&e.length===32,"topic must be a Buffer of 32 bytes"),Z(Buffer.isBuffer(t)&&t.length===32,"peerId must be a Buffer of 32 bytes");const{metadata:i,simplePeer:s={}}=r,o=this[Wn]({initiator:!0,sessionId:ts.randomBytes(32),id:t,topic:e,localMetadata:i,simplePeer:s});return this[Un](o),o}onIncomingPeer(e){return this._onIncomingPeer=e,this}onOffer(e){return this._onOffer=e,this}onAnswer(e){return this._onAnswer=e,this}closeConnectionsByTopic(e){return Promise.all(this.getPeersByTopic(e).map(t=>new Promise(r=>t.close(()=>r()))))}async _onIncomingPeer(){}async _onOffer(e){}async _onAnswer(e){}async _open(){await this.rpc.open()}async _close(){this[Bn].kill(),await this.rpc.close(),await Promise.all(this.peers.map(e=>new Promise(t=>e.close(()=>t()))))}_buildMessage(e){const s=e,{localMetadata:t={}}=s,r=te(s,["localMetadata"]);let i=this.metadata||{};return t&&(i=R(R({},i),t)),q(R({},r),{id:this.id,metadata:i})}[is](){this.rpc.actions({offer:async e=>{const t=await this._onOffer(e);Z(!t||typeof t=="object");const r=this[Wn]({initiator:!1,sessionId:e.sessionId,id:e.id,topic:e.topic,metadata:e.metadata,localMetadata:t&&t.metadata,simplePeer:t&&t.simplePeer});return this[Un](r,e.data),eu(r,"answer",{rejectionEvents:["error","closed"]})}})}[ss](){this.rpc.on("signal",e=>{const{sessionId:t,data:r=[]}=e,i=this[tt].get(t.toString("hex"));!i||i.destroyed||r.forEach(s=>i.stream.signal(s))})}[Un](e,t){const r=e.sessionId.toString("hex");this[tt].set(r,e),e.once("close",()=>{this[tt].delete(r)}),e.once("error",i=>{this.emit("peer-error",i,e)}),this[Bn].push({peer:e,data:t},i=>{if(i||this.closing||this.closed)return process.nextTick(()=>e.destroy(i));this.emit("peer-connected",e)}),this.emit("peer-queue",e)}[Wn](e){e=Object.assign({},e,{onSignal:(r,i)=>this[os](r,i),simplePeer:Object.assign({},this.simplePeer,e.simplePeer),timeout:this.requestTimeout});let t;return typeof this.simplePeer=="function"&&(t=this.simplePeer(rs,e)),t=new rs(e),t}async[os](e,t){if(e.destroyed||e.connected&&!e.subscribeMediaStream)return;const r=()=>this._buildMessage({remoteId:e.id,topic:e.topic,sessionId:e.sessionId,data:t,localMetadata:e.localMetadata});if(!e.connected){const i=t[0].type;if(i==="offer"){const s=await this.rpc.call("offer",r());await this._onAnswer(s),s.data.forEach(o=>e.stream.signal(o)),e.metadata=s.metadata;return}if(i==="answer")return await this._onIncomingPeer(e),e.emit("answer",r())}await this.rpc.emit("signal",r())}}var iu=ru;const su=G,as=Pe.exports,{NanoresourcePromise:ou}=Ae.exports,Hn=j.exports("socketsignal:server"),cs=Symbol("socketsignal.defineactions"),ls=Symbol("socketsignal.defineevents");class au extends ou{constructor(e={}){super();const h=e,{onConnect:t,onDisconnect:r,onJoin:i,onLeave:s,onLookup:o,onOffer:c,onSignal:a,requestTimeout:u=10*1e3}=h,l=te(h,["onConnect","onDisconnect","onJoin","onLeave","onLookup","onOffer","onSignal","requestTimeout"]);t&&(this._onConnect=t),r&&(this._onDisconnect=r),i&&(this._onJoin=i),s&&(this._onLeave=s),o&&(this._onLookup=o),c&&(this._onOffer=c),a&&(this._onSignal=a),this._requestTimeout=u,this._rpcOpts=l,this.connections=new Set}async addSocket(e){await this.open();const t=as(R(R({timeout:this._requestTimeout},this._rpcOpts),as.useSocket(e)));this[cs](t),this[ls](t),t.id=su.randomBytes(32),t.socket=e;const r=()=>{if(this.connections.delete(t))return Hn("connection-deleted",t.id.toString("hex")),this._onDisconnect(t)};t.ee.on("closed",r),t.ee.on("error",i=>this.emit("connection-error",i,t)),await t.open();try{Hn("connection-added",t.id.toString("hex")),await this._onConnect(t),this.connections.add(t)}catch(i){t.closed().then(r).catch(r).finally(()=>{this.emit("connection-error",i,t)})}return t}async _open(){}async _close(){await Promise.all(Array.from(this.connections.values()).map(e=>e.close()))}async _onConnect(){}async _onDisconnect(){}async _onJoin(){}async _onLeave(){}async _onLookup(){}async _onOffer(){}async _onSignal(){}[cs](e){e.actions({join:(t={})=>this._onJoin(e,t),leave:(t={})=>this._onLeave(e,t),offer:(t={})=>this._onOffer(e,t),lookup:(t={})=>this._onLookup(e,t)})}[ls](e){e.on("signal",async(t={})=>{try{await this._onSignal(e,t)}catch(r){Hn("signal error",r)}})}}var us=au;const cu=us,{ERR_PEER_NOT_FOUND:lu}=jt,Me=j.exports("socket-signal:server-map");class uu extends cu{constructor(e={}){super(e);this._peersByTopic=new Map}addPeer(e,t,r){const i=r.toString("hex"),s=t.toString("hex"),o=this._peersByTopic.get(i)||new Map;o.set(s,{rpc:e,id:t}),this._peersByTopic.set(i,o)}deletePeer(e,t){const r=e.toString("hex");if(!t){this._peersByTopic.forEach((s,o)=>{s.delete(r)&&Me("peer-leave",r+" from "+o)});return}const i=t.toString("hex");this._peersByTopic.has(i)&&this._peersByTopic.get(i).delete(r)&&Me("peer-leave",r+" from "+i)}getPeers(e){const t=e.toString("hex");return this._peersByTopic.has(t)?Array.from(this._peersByTopic.get(t).values()).map(r=>r.id):[]}findPeer(e,t){const r=e.toString("hex"),i=this._peersByTopic.get(t.toString("hex"));if(!i||!i.has(r))throw new lu(r);return i.get(r)}async _onDisconnect(e){let t;this._peersByTopic.forEach(r=>{for(const[i,s]of r)if(s.rpc===e){t=s.id,r.delete(i);break}}),t&&Me("peer-disconnected",t.toString("hex"))}async _onJoin(e,t){return this.addPeer(e,t.id,t.topic),Me("peer-join",t.id.toString("hex")+" in "+t.topic.toString("hex")),this.getPeers(t.topic)}async _onLeave(e,t){this.deletePeer(t.id,t.topic)}async _onOffer(e,t){const r=this.findPeer(t.remoteId,t.topic);return Me(`peer-offer ${t.id.toString("hex")} -> ${t.remoteId.toString("hex")}`),r.rpc.call("offer",t)}async _onLookup(e,t){return this.getPeers(t.topic)}async _onSignal(e,t){const r=this.findPeer(t.remoteId,t.topic);Me(`peer-signal ${t.id.toString("hex")} -> ${t.remoteId.toString("hex")}`),r.rpc.emit("signal",t).catch(()=>{})}}var hu=uu,fu={SocketSignalClient:iu,SocketSignalServer:us,SocketSignalServerMap:hu,Peer:es,SignalBatch:Xi,errors:jt};/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var Gn=function(n,e){return Gn=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var i in r)r.hasOwnProperty(i)&&(t[i]=r[i])},Gn(n,e)};function hs(n,e){Gn(n,e);function t(){this.constructor=n}n.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function du(n){var e=typeof Symbol=="function"&&n[Symbol.iterator],t=0;return e?e.call(n):{next:function(){return n&&t>=n.length&&(n=void 0),{value:n&&n[t++],done:!n}}}}function pu(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(c){o={error:c}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(o)throw o.error}}return s}function _u(){for(var n=[],e=0;e<arguments.length;e++)n=n.concat(pu(arguments[e]));return n}var fs=function(){function n(e,t){this.target=t,this.type=e}return n}(),gu=function(n){hs(e,n);function e(t,r){var i=n.call(this,"error",r)||this;return i.message=t.message,i.error=t,i}return e}(fs),mu=function(n){hs(e,n);function e(t,r,i){t===void 0&&(t=1e3),r===void 0&&(r="");var s=n.call(this,"close",i)||this;return s.wasClean=!0,s.code=t,s.reason=r,s}return e}(fs);/*!
 * Reconnecting WebSocket
 * by Pedro Ladaria <pedro.ladaria@gmail.com>
 * https://github.com/pladaria/reconnecting-websocket
 * License MIT
 */var yu=function(){if(typeof WebSocket!="undefined")return WebSocket},bu=function(n){return typeof n!="undefined"&&!!n&&n.CLOSING===2},pe={maxReconnectionDelay:1e4,minReconnectionDelay:1e3+Math.random()*4e3,minUptime:5e3,reconnectionDelayGrowFactor:1.3,connectionTimeout:4e3,maxRetries:1/0,maxEnqueuedMessages:1/0,startClosed:!1,debug:!1},vu=function(){function n(e,t,r){var i=this;r===void 0&&(r={}),this._listeners={error:[],message:[],open:[],close:[]},this._retryCount=-1,this._shouldReconnect=!0,this._connectLock=!1,this._binaryType="blob",this._closeCalled=!1,this._messageQueue=[],this.onclose=null,this.onerror=null,this.onmessage=null,this.onopen=null,this._handleOpen=function(s){i._debug("open event");var o=i._options.minUptime,c=o===void 0?pe.minUptime:o;clearTimeout(i._connectTimeout),i._uptimeTimeout=setTimeout(function(){return i._acceptOpen()},c),i._ws.binaryType=i._binaryType,i._messageQueue.forEach(function(a){return i._ws.send(a)}),i._messageQueue=[],i.onopen&&i.onopen(s),i._listeners.open.forEach(function(a){return i._callEventListener(s,a)})},this._handleMessage=function(s){i._debug("message event"),i.onmessage&&i.onmessage(s),i._listeners.message.forEach(function(o){return i._callEventListener(s,o)})},this._handleError=function(s){i._debug("error event",s.message),i._disconnect(void 0,s.message==="TIMEOUT"?"timeout":void 0),i.onerror&&i.onerror(s),i._debug("exec error listeners"),i._listeners.error.forEach(function(o){return i._callEventListener(s,o)}),i._connect()},this._handleClose=function(s){i._debug("close event"),i._clearTimeouts(),i._shouldReconnect&&i._connect(),i.onclose&&i.onclose(s),i._listeners.close.forEach(function(o){return i._callEventListener(s,o)})},this._url=e,this._protocols=t,this._options=r,this._options.startClosed&&(this._shouldReconnect=!1),this._connect()}return Object.defineProperty(n,"CONNECTING",{get:function(){return 0},enumerable:!0,configurable:!0}),Object.defineProperty(n,"OPEN",{get:function(){return 1},enumerable:!0,configurable:!0}),Object.defineProperty(n,"CLOSING",{get:function(){return 2},enumerable:!0,configurable:!0}),Object.defineProperty(n,"CLOSED",{get:function(){return 3},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"CONNECTING",{get:function(){return n.CONNECTING},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"OPEN",{get:function(){return n.OPEN},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"CLOSING",{get:function(){return n.CLOSING},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"CLOSED",{get:function(){return n.CLOSED},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"binaryType",{get:function(){return this._ws?this._ws.binaryType:this._binaryType},set:function(e){this._binaryType=e,this._ws&&(this._ws.binaryType=e)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"retryCount",{get:function(){return Math.max(this._retryCount,0)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"bufferedAmount",{get:function(){var e=this._messageQueue.reduce(function(t,r){return typeof r=="string"?t+=r.length:r instanceof Blob?t+=r.size:t+=r.byteLength,t},0);return e+(this._ws?this._ws.bufferedAmount:0)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"extensions",{get:function(){return this._ws?this._ws.extensions:""},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"protocol",{get:function(){return this._ws?this._ws.protocol:""},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"readyState",{get:function(){return this._ws?this._ws.readyState:this._options.startClosed?n.CLOSED:n.CONNECTING},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"url",{get:function(){return this._ws?this._ws.url:""},enumerable:!0,configurable:!0}),n.prototype.close=function(e,t){if(e===void 0&&(e=1e3),this._closeCalled=!0,this._shouldReconnect=!1,this._clearTimeouts(),!this._ws){this._debug("close enqueued: no ws instance");return}if(this._ws.readyState===this.CLOSED){this._debug("close: already closed");return}this._ws.close(e,t)},n.prototype.reconnect=function(e,t){this._shouldReconnect=!0,this._closeCalled=!1,this._retryCount=-1,!this._ws||this._ws.readyState===this.CLOSED?this._connect():(this._disconnect(e,t),this._connect())},n.prototype.send=function(e){if(this._ws&&this._ws.readyState===this.OPEN)this._debug("send",e),this._ws.send(e);else{var t=this._options.maxEnqueuedMessages,r=t===void 0?pe.maxEnqueuedMessages:t;this._messageQueue.length<r&&(this._debug("enqueue",e),this._messageQueue.push(e))}},n.prototype.addEventListener=function(e,t){this._listeners[e]&&this._listeners[e].push(t)},n.prototype.dispatchEvent=function(e){var t,r,i=this._listeners[e.type];if(i)try{for(var s=du(i),o=s.next();!o.done;o=s.next()){var c=o.value;this._callEventListener(e,c)}}catch(a){t={error:a}}finally{try{o&&!o.done&&(r=s.return)&&r.call(s)}finally{if(t)throw t.error}}return!0},n.prototype.removeEventListener=function(e,t){this._listeners[e]&&(this._listeners[e]=this._listeners[e].filter(function(r){return r!==t}))},n.prototype._debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._options.debug&&console.log.apply(console,_u(["RWS>"],e))},n.prototype._getNextDelay=function(){var e=this._options,t=e.reconnectionDelayGrowFactor,r=t===void 0?pe.reconnectionDelayGrowFactor:t,i=e.minReconnectionDelay,s=i===void 0?pe.minReconnectionDelay:i,o=e.maxReconnectionDelay,c=o===void 0?pe.maxReconnectionDelay:o,a=0;return this._retryCount>0&&(a=s*Math.pow(r,this._retryCount-1),a>c&&(a=c)),this._debug("next delay",a),a},n.prototype._wait=function(){var e=this;return new Promise(function(t){setTimeout(t,e._getNextDelay())})},n.prototype._getNextUrl=function(e){if(typeof e=="string")return Promise.resolve(e);if(typeof e=="function"){var t=e();if(typeof t=="string")return Promise.resolve(t);if(t.then)return t}throw Error("Invalid URL")},n.prototype._connect=function(){var e=this;if(!(this._connectLock||!this._shouldReconnect)){this._connectLock=!0;var t=this._options,r=t.maxRetries,i=r===void 0?pe.maxRetries:r,s=t.connectionTimeout,o=s===void 0?pe.connectionTimeout:s,c=t.WebSocket,a=c===void 0?yu():c;if(this._retryCount>=i){this._debug("max retries reached",this._retryCount,">=",i);return}if(this._retryCount++,this._debug("connect",this._retryCount),this._removeListeners(),!bu(a))throw Error("No valid WebSocket class provided");this._wait().then(function(){return e._getNextUrl(e._url)}).then(function(u){e._closeCalled||(e._debug("connect",{url:u,protocols:e._protocols}),e._ws=e._protocols?new a(u,e._protocols):new a(u),e._ws.binaryType=e._binaryType,e._connectLock=!1,e._addListeners(),e._connectTimeout=setTimeout(function(){return e._handleTimeout()},o))})}},n.prototype._handleTimeout=function(){this._debug("timeout event"),this._handleError(new gu(Error("TIMEOUT"),this))},n.prototype._disconnect=function(e,t){if(e===void 0&&(e=1e3),this._clearTimeouts(),!!this._ws){this._removeListeners();try{this._ws.close(e,t),this._handleClose(new mu(e,t,this))}catch{}}},n.prototype._acceptOpen=function(){this._debug("accept open"),this._retryCount=0},n.prototype._callEventListener=function(e,t){"handleEvent"in t?t.handleEvent(e):t(e)},n.prototype._removeListeners=function(){!this._ws||(this._debug("removeListeners"),this._ws.removeEventListener("open",this._handleOpen),this._ws.removeEventListener("close",this._handleClose),this._ws.removeEventListener("message",this._handleMessage),this._ws.removeEventListener("error",this._handleError))},n.prototype._addListeners=function(){!this._ws||(this._debug("addListeners"),this._ws.addEventListener("open",this._handleOpen),this._ws.addEventListener("close",this._handleClose),this._ws.addEventListener("message",this._handleMessage),this._ws.addEventListener("error",this._handleError))},n.prototype._clearTimeouts=function(){clearTimeout(this._connectTimeout),clearTimeout(this._uptimeTimeout)},n}(),wu=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",default:vu}),Eu=sr(wu);const Su=lc,Cu=me,Ru=uc,Tu=yn.exports,{SocketSignalClient:Pu}=fu,Vn=j.exports("socket-signal:websocket-client"),Ou=n=>{let e=0;return()=>{const t=n[e++%n.length];return Vn("url provider",t),t}};let Bt=Eu;Bt.default&&(Bt=Bt.default);class zn extends Pu{static createSocket(e,t={}){Cu(Array.isArray(e)||typeof e=="function","must be an array or a function");const{simpleWebsocket:r={},reconnectingWebsocket:i={}}=t;Array.isArray(e)&&(e=Ou(e)),i.WebSocket||(i.WebSocket=Ru);const s=new Bt(e,i.protocols,i),o=new Su(R({socket:s},r)),c=s.onopen,a=s.onclose,u=s.onerror;return s.onopen=l=>{o._chunk&&!o._cb&&(o._cb=()=>{}),c(l)},s.onclose=l=>{Vn("socket close",{shouldReconnect:s._shouldReconnect,ev:l}),s._shouldReconnect?o.connected=!1:a(l)},s.onerror=l=>{Vn("socket error",{shouldReconnect:s._shouldReconnect,ev:l}),s._shouldReconnect?o.connected=!1:u(l)},{ws:s,socket:o}}constructor(e,t={}){const h=t,{heartbeat:r=!1,simpleWebsocket:i,reconnectingWebsocket:s,onSocket:o=f=>f}=h,c=te(h,["heartbeat","simpleWebsocket","reconnectingWebsocket","onSocket"]),{ws:a,socket:u}=zn.createSocket(e,{simpleWebsocket:i,reconnectingWebsocket:s});super(o(u),c);this._ws=a,this._heartbeat=r,this._lastPing=0;let l=!1;this.socket.on("connect",()=>{this.emit("connected",l),l=!0})}get connected(){return this._ws.readyState===this._ws.OPEN}get lastPing(){return this._lastPing}async _open(){return this._heartbeat&&this._startHeartbeat(this._heartbeat),super._open()}async _startHeartbeat(e={}){const{interval:t=10*1e3,timeout:r=5*1e3}=typeof e=="boolean"?{}:e;for(;!(this.closed||this.closing);)if(await Tu(t),this.connected&&this.opened){const i=await this.rpc.call("__ping__",{time:Date.now()},{timeout:r}).catch(s=>{if(this.emit("ping-error",s),!(this.closed||this.closing)&&s.code==="NMSG_ERR_TIMEOUT")return this._ws.reconnect()});i&&(this.emit("ping",i.time),this._lastPing=i.time)}}}var Au=zn,ku={SocketSignalWebsocketClient:Au},Qn={exports:{}};const Nu=(n,e)=>Math.floor(Math.random()*(e-n+1)+n),ds=()=>{const n=new Error("Delay aborted");return n.name="AbortError",n},Ut=({clearTimeout:n,setTimeout:e,willResolve:t})=>(r,{value:i,signal:s}={})=>{if(s&&s.aborted)return Promise.reject(ds());let o,c,a;const u=n||clearTimeout,l=()=>{u(o),a(ds())},h=()=>{s&&s.removeEventListener("abort",l)},f=new Promise((_,d)=>{c=()=>{h(),t?_(i):d(i)},a=d,o=(e||setTimeout)(c,r)});return s&&s.addEventListener("abort",l,{once:!0}),f.clear=()=>{u(o),o=null,c()},f},Ie=Ut({willResolve:!0});Ie.reject=Ut({willResolve:!1});Ie.range=(n,e,t)=>Ie(Nu(n,e),t);Ie.createWithTimers=({clearTimeout:n,setTimeout:e})=>{const t=Ut({clearTimeout:n,setTimeout:e,willResolve:!0});return t.reject=Ut({clearTimeout:n,setTimeout:e,willResolve:!1}),t};Qn.exports=Ie;Qn.exports.default=Ie;var Lu=lt,Mu=function(e,t={}){return new Promise((r,i)=>{function s(o){o?i(o):r()}Lu(e,t,s)})},Iu=Wt;Wt.defer=Yn;function Wt(n){return n==null&&(n=N.Promise),this instanceof Wt?Yn(n,this):Yn(n,Object.create(Wt.prototype))}function Yn(n,e){return e.promise=new n(function(t,r){e.resolve=t,e.reject=r}),e}var Du=function(n){if(!Array.isArray(n))throw"C'mon pal. You gotta feed this thing *arrays*!";const e=[];let t=n.slice();for(;t.length;){const r=Math.floor(Math.random()*t.length);e.push(t.splice(r,1)[0])}return e},xu=ee;function ee(n,e){if(n.length!==e.length)throw new Error("Inputs should have the same length");for(var t=Buffer.allocUnsafe(n.length),r=0;r<n.length;r++)t[r]=n[r]^e[r];return t}ee.compare=function(e,t){if(e.length!==t.length)throw new Error("Inputs should have the same length");for(var r=0;r<e.length;r++)if(e[r]!==t[r])return e[r]<t[r]?-1:1;return 0};ee.gt=function(e,t){return ee.compare(e,t)===1};ee.lt=function(e,t){return ee.compare(e,t)===-1};ee.eq=function(e,t){return ee.compare(e,t)===0};var Kn={},ps={exports:{}};(function(n){var e=Object.prototype.hasOwnProperty,t="~";function r(){}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(t=!1));function i(a,u,l){this.fn=a,this.context=u,this.once=l||!1}function s(a,u,l,h,f){if(typeof l!="function")throw new TypeError("The listener must be a function");var _=new i(l,h||a,f),d=t?t+u:u;return a._events[d]?a._events[d].fn?a._events[d]=[a._events[d],_]:a._events[d].push(_):(a._events[d]=_,a._eventsCount++),a}function o(a,u){--a._eventsCount==0?a._events=new r:delete a._events[u]}function c(){this._events=new r,this._eventsCount=0}c.prototype.eventNames=function(){var u=[],l,h;if(this._eventsCount===0)return u;for(h in l=this._events)e.call(l,h)&&u.push(t?h.slice(1):h);return Object.getOwnPropertySymbols?u.concat(Object.getOwnPropertySymbols(l)):u},c.prototype.listeners=function(u){var l=t?t+u:u,h=this._events[l];if(!h)return[];if(h.fn)return[h.fn];for(var f=0,_=h.length,d=new Array(_);f<_;f++)d[f]=h[f].fn;return d},c.prototype.listenerCount=function(u){var l=t?t+u:u,h=this._events[l];return h?h.fn?1:h.length:0},c.prototype.emit=function(u,l,h,f,_,d){var m=t?t+u:u;if(!this._events[m])return!1;var p=this._events[m],E=arguments.length,O,g;if(p.fn){switch(p.once&&this.removeListener(u,p.fn,void 0,!0),E){case 1:return p.fn.call(p.context),!0;case 2:return p.fn.call(p.context,l),!0;case 3:return p.fn.call(p.context,l,h),!0;case 4:return p.fn.call(p.context,l,h,f),!0;case 5:return p.fn.call(p.context,l,h,f,_),!0;case 6:return p.fn.call(p.context,l,h,f,_,d),!0}for(g=1,O=new Array(E-1);g<E;g++)O[g-1]=arguments[g];p.fn.apply(p.context,O)}else{var T=p.length,w;for(g=0;g<T;g++)switch(p[g].once&&this.removeListener(u,p[g].fn,void 0,!0),E){case 1:p[g].fn.call(p[g].context);break;case 2:p[g].fn.call(p[g].context,l);break;case 3:p[g].fn.call(p[g].context,l,h);break;case 4:p[g].fn.call(p[g].context,l,h,f);break;default:if(!O)for(w=1,O=new Array(E-1);w<E;w++)O[w-1]=arguments[w];p[g].fn.apply(p[g].context,O)}}return!0},c.prototype.on=function(u,l,h){return s(this,u,l,h,!1)},c.prototype.once=function(u,l,h){return s(this,u,l,h,!0)},c.prototype.removeListener=function(u,l,h,f){var _=t?t+u:u;if(!this._events[_])return this;if(!l)return o(this,_),this;var d=this._events[_];if(d.fn)d.fn===l&&(!f||d.once)&&(!h||d.context===h)&&o(this,_);else{for(var m=0,p=[],E=d.length;m<E;m++)(d[m].fn!==l||f&&!d[m].once||h&&d[m].context!==h)&&p.push(d[m]);p.length?this._events[_]=p.length===1?p[0]:p:o(this,_)}return this},c.prototype.removeAllListeners=function(u){var l;return u?(l=t?t+u:u,this._events[l]&&o(this,l)):(this._events=new r,this._eventsCount=0),this},c.prototype.off=c.prototype.removeListener,c.prototype.addListener=c.prototype.on,c.prefixed=t,c.EventEmitter=c,n.exports=c})(ps);var Jn={},Xn={};Object.defineProperty(Xn,"__esModule",{value:!0});function Fu(n,e,t){let r=0,i=n.length;for(;i>0;){const s=i/2|0;let o=r+s;t(n[o],e)<=0?(r=++o,i-=s+1):i=s}return r}Xn.default=Fu;Object.defineProperty(Jn,"__esModule",{value:!0});const qu=Xn;class ju{constructor(){this._queue=[]}enqueue(e,t){t=Object.assign({priority:0},t);const r={priority:t.priority,run:e};if(this.size&&this._queue[this.size-1].priority>=t.priority){this._queue.push(r);return}const i=qu.default(this._queue,r,(s,o)=>o.priority-s.priority);this._queue.splice(i,0,r)}dequeue(){const e=this._queue.shift();return e==null?void 0:e.run}filter(e){return this._queue.filter(t=>t.priority===e.priority).map(t=>t.run)}get size(){return this._queue.length}}Jn.default=ju;Object.defineProperty(Kn,"__esModule",{value:!0});const $u=ps.exports,_s=Qe.exports,Bu=Jn,Ht=()=>{},Uu=new _s.TimeoutError;class Wu extends $u{constructor(e){var t,r,i,s;super();if(this._intervalCount=0,this._intervalEnd=0,this._pendingCount=0,this._resolveEmpty=Ht,this._resolveIdle=Ht,e=Object.assign({carryoverConcurrencyCount:!1,intervalCap:1/0,interval:0,concurrency:1/0,autoStart:!0,queueClass:Bu.default},e),!(typeof e.intervalCap=="number"&&e.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${(r=(t=e.intervalCap)===null||t===void 0?void 0:t.toString())!==null&&r!==void 0?r:""}\` (${typeof e.intervalCap})`);if(e.interval===void 0||!(Number.isFinite(e.interval)&&e.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${(s=(i=e.interval)===null||i===void 0?void 0:i.toString())!==null&&s!==void 0?s:""}\` (${typeof e.interval})`);this._carryoverConcurrencyCount=e.carryoverConcurrencyCount,this._isIntervalIgnored=e.intervalCap===1/0||e.interval===0,this._intervalCap=e.intervalCap,this._interval=e.interval,this._queue=new e.queueClass,this._queueClass=e.queueClass,this.concurrency=e.concurrency,this._timeout=e.timeout,this._throwOnTimeout=e.throwOnTimeout===!0,this._isPaused=e.autoStart===!1}get _doesIntervalAllowAnother(){return this._isIntervalIgnored||this._intervalCount<this._intervalCap}get _doesConcurrentAllowAnother(){return this._pendingCount<this._concurrency}_next(){this._pendingCount--,this._tryToStartAnother(),this.emit("next")}_resolvePromises(){this._resolveEmpty(),this._resolveEmpty=Ht,this._pendingCount===0&&(this._resolveIdle(),this._resolveIdle=Ht,this.emit("idle"))}_onResumeInterval(){this._onInterval(),this._initializeIntervalIfNeeded(),this._timeoutId=void 0}_isIntervalPaused(){const e=Date.now();if(this._intervalId===void 0){const t=this._intervalEnd-e;if(t<0)this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0;else return this._timeoutId===void 0&&(this._timeoutId=setTimeout(()=>{this._onResumeInterval()},t)),!0}return!1}_tryToStartAnother(){if(this._queue.size===0)return this._intervalId&&clearInterval(this._intervalId),this._intervalId=void 0,this._resolvePromises(),!1;if(!this._isPaused){const e=!this._isIntervalPaused();if(this._doesIntervalAllowAnother&&this._doesConcurrentAllowAnother){const t=this._queue.dequeue();return t?(this.emit("active"),t(),e&&this._initializeIntervalIfNeeded(),!0):!1}}return!1}_initializeIntervalIfNeeded(){this._isIntervalIgnored||this._intervalId!==void 0||(this._intervalId=setInterval(()=>{this._onInterval()},this._interval),this._intervalEnd=Date.now()+this._interval)}_onInterval(){this._intervalCount===0&&this._pendingCount===0&&this._intervalId&&(clearInterval(this._intervalId),this._intervalId=void 0),this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0,this._processQueue()}_processQueue(){for(;this._tryToStartAnother(););}get concurrency(){return this._concurrency}set concurrency(e){if(!(typeof e=="number"&&e>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${e}\` (${typeof e})`);this._concurrency=e,this._processQueue()}async add(e,t={}){return new Promise((r,i)=>{const s=async()=>{this._pendingCount++,this._intervalCount++;try{const o=this._timeout===void 0&&t.timeout===void 0?e():_s.default(Promise.resolve(e()),t.timeout===void 0?this._timeout:t.timeout,()=>{(t.throwOnTimeout===void 0?this._throwOnTimeout:t.throwOnTimeout)&&i(Uu)});r(await o)}catch(o){i(o)}this._next()};this._queue.enqueue(s,t),this._tryToStartAnother(),this.emit("add")})}async addAll(e,t){return Promise.all(e.map(async r=>this.add(r,t)))}start(){return this._isPaused?(this._isPaused=!1,this._processQueue(),this):this}pause(){this._isPaused=!0}clear(){this._queue=new this._queueClass}async onEmpty(){if(this._queue.size!==0)return new Promise(e=>{const t=this._resolveEmpty;this._resolveEmpty=()=>{t(),e()}})}async onIdle(){if(!(this._pendingCount===0&&this._queue.size===0))return new Promise(e=>{const t=this._resolveIdle;this._resolveIdle=()=>{t(),e()}})}get size(){return this._queue.size}sizeBy(e){return this._queue.filter(e).length}get pending(){return this._pendingCount}get isPaused(){return this._isPaused}get timeout(){return this._timeout}set timeout(e){this._timeout=e}}Kn.default=Wu;const Hu=Qn.exports,Gu=Mu,Vu=Iu,zu=Du,Zn=xu,Qu=Kn.default,Yu=ge.exports,Ku=10,Ju=.33,Xu=1e3,Zu=4;var eh=class extends Yu{constructor({id:e,lookup:t,connect:r,sampleSize:i=Ku,percentFar:s=Ju,maxPeers:o=Zu,lookupTimeout:c=Xu,queueTimeout:a=c+2*1e3}){super();if(this.id=e,this._lookup=t,this._connect=r,this.sampleSize=i,this.percentFar=s,this.maxPeers=o,c>a)throw new Error("queueTimeout must be higher than lookupTimeout");this.lookupTimeout=c,this.queue=new Qu({concurrency:1,timeout:a}),this.connectedPeers=new Set,this.hasConnectedFar=!1,this.destroyed=!1}shouldHandleIncoming(){return this.connectedPeers.size<this.maxPeers}handleIncoming(e,t){if(!this.shouldHandleIncoming()){t.close();return}this.addConnection(e,t)}addConnection(e,t,r){const i=e.toString("hex");this.connectedPeers.add(i),t.once("close",()=>{this.connectedPeers.delete(i),(r||this.connectedPeers.size===0)&&this.queue.add(()=>this.run())})}async run(){if(!this.shouldHandleIncoming()||this.destroyed)return;const e=[],t=this._lookup(),r=Vu(),i=Promise.race([Gu(t),Hu(this.lookupTimeout),r.promise]);if(t.on("data",a=>{e.push(...a),e.length>=this.sampleSize&&r.resolve()}),await i,this.destroyed)return;let s=e.slice();s.length>this.sampleSize&&(s=zu(e).slice(0,this.sampleSize)),s.sort((a,u)=>Zn.gt(Zn(this.id,a),Zn(this.id,u)));let o=!1;for(let a of s){if(this.destroyed)return;const u=a.toString("hex");if(!this.connectedPeers.has(u))try{const l=await this._connect(a);o=!0,this.addConnection(a,l,!0);break}catch{}}if(!o){this.emit("nopeers");return}if(!(this.hasConnectedFar||this.connectedPeers.size>=this.maxPeers||Math.random()>this.percentFar)){s.reverse();for(let a of s){if(this.destroyed)return;const u=a.toString("hex");if(!this.connectedPeers.has(u))try{const l=await this._connect(a);this.addConnection(a,l,!0),this.hasConnectedFar=!0,l.once("close",()=>{this.hasConnectedFar=!1});break}catch{}}}}async destroy(){this.destroyed=!0}};const th=n=>{if(typeof n=="string")return n;if(Buffer.isBuffer(n))return n.toString("hex");throw new Error("Cannot convert the buffer to hex: ",n)},nh=n=>{if(Buffer.isBuffer(n))return n;if(typeof n=="string")return Buffer.from(n,"hex");throw new Error("Cannot convert the string to buffer: ",n)},rh=()=>{let n;const e=new Promise((t,r)=>{n=(i,s)=>{i?r(i):t(s)}});return n.promise=e,n},ih=(n,e)=>(n.then||(n=Promise.resolve()),n.then(t=>e(null,t)).catch(e));var gs={toHex:th,toBuffer:nh,callbackPromise:rh,resolveCallback:ih},er={};(function(n){const e=Mt;function t(r,i){n[r]=e(r,i)}t("ERR_MAX_PEERS_REACHED","max peers reached: %s"),t("ERR_INVALID_CHANNEL","invalid channel: %s"),t("ERR_CONNECTION_DUPLICATED","connection duplicated: %s -> %s")})(er);const sh=n=>{let e,t=!1;const r=new Promise((i,s)=>{const o=setTimeout(()=>{t=!0,i()},n);e=()=>{t||(clearTimeout(o),s(new Error("timeout")))}});return r.cancel=e,r};class oh{constructor(e){this._fn=e,this._stop=!1,this.run()}run(){(async()=>{for(;!this._stop;){if(this._time=sh(Math.floor(Math.random()*11)*1e3),await this._time,this._stop)return;await this._fn()}})().catch(()=>{})}stop(){this._time&&this._time.cancel(),this._stop=!0}}var ah=class{constructor(){this._tasks=new Map}add(e,t){this._tasks.set(e,new oh(t))}delete(e){const t=this._tasks.get(e);t&&t.stop(),this._tasks.delete(e)}clear(){this._tasks.forEach(e=>{e.stop()}),this._tasks.clear()}};const{SocketSignalWebsocketClient:ch}=ku,lh=eh,ms=me,{Readable:uh}=G,ys=j.exports("discovery-swarm-webrtc:mmst-signal"),{toHex:_e}=gs,{ERR_INVALID_CHANNEL:hh,ERR_MAX_PEERS_REACHED:fh}=er,dh=ah,bs=n=>ms(Buffer.isBuffer(n)&&n.length===32,"Channel must be a buffer of 32 bytes"),nt=Symbol("mmstsignal.onconnected"),rt=Symbol("mmstsignal.getcandidates");var ph=class extends ch{constructor(e={}){const c=e,{bootstrap:t,createConnection:r,mmstOpts:i={},strict:s=!0}=c,o=te(c,["bootstrap","createConnection","mmstOpts","strict"]);super(t,o);this._createConnection=r,this._mmstOpts=i,this._strict=s,this._channels=new Map,this._mmsts=new Map,this._candidates=new Map,this._scheduler=new dh,this[nt]=this[nt].bind(this)}join(e){bs(e);const t=_e(e);if(!this._channels.has(t)){this._channels.set(t,e);const r={id:this.id,lookup:()=>this._lookup(e),connect:async s=>{await this.open();try{const o=this.connect(e,s);return this._runCreateConnection(o),await o.ready(),o.stream}catch(o){const c=this[rt](e);throw c.list=c.list.filter(a=>!a.equals(s)),c.list.length===0&&(c.lookup=!0),o}}};let i;typeof this._mmstOpts=="function"?i=this._mmstOpts(r):i=new lh(R(R({},this._mmstOpts),r)),this._mmsts.set(t,i)}this.connected&&super.join(e).catch(()=>{})}async leave(e){bs(e);const t=_e(e);this._scheduler.delete(t),this._mmsts.get(t).destroy(),this._mmsts.delete(t),this._channels.delete(t),this._candidates.delete(t),await super.leave(e),await super.closeConnectionsByTopic(e)}async _open(){this.on("connected",this[nt]),this.on("join",async(e,t)=>{ys("discover",{channel:e}),!!this.hasChannel(e)&&(await this._updateCandidates(e,t),await this._run(e),this._scheduler.add(e.toString("hex"),async()=>{const r=this[rt](e);(r.list.length===0||this.getPeersByTopic(e).length===0)&&(r.lookup=!0,await this._updateCandidates(e),await this._run(e))}))}),this.onIncomingPeer(e=>this._runCreateConnection(e)),await super._open()}hasChannel(e){return this._channels.has(_e(e))}_runCreateConnection(e){if(!this.hasChannel(e.topic))throw new hh(_e(e.topic));const t=this._getMMST(e.topic);if(this._strict&&!e.initiator&&!t.shouldHandleIncoming())throw new fh(this._mmstOpts.maxPeers);return this._createConnection(e),e.initiator||t.addConnection(e.id,e.stream),e}async _close(){await super._close(),this.removeListener("connected",this[nt]),this._mmsts.forEach(e=>e.destroy()),this._mmsts.clear(),this._channels.clear(),this._candidates.clear(),this._scheduler.clear()}async _run(e){if(!!this.connected&&!(this.getPeersByTopic(e).filter(t=>t.initiator).length>0))try{this.hasChannel(e)&&await this._getMMST(e).run()}catch(t){ys("run error",t.message)}}_getMMST(e){return this._mmsts.get(_e(e))}_lookup(e){const t=new uh({read(){},objectMode:!0});return this._updateCandidates(e).finally(()=>{t.push(this[rt](e).list),t.push(null)}),t}async[nt](e){this._channels.forEach(t=>super.join(t).catch(()=>{}))}async _updateCandidates(e,t){const r=this[rt](e);let i=r.list;if(t)i=t;else if(r.lookup){r.lookup=!1;try{i=await this.lookup(e)}catch{}}r.list=i.filter(s=>!s.equals(this.id)),this.emit("candidates-updated",e,i)}[rt](e){ms(Buffer.isBuffer(e));let t=this._candidates.get(_e(e));return t||(t={list:[],lookup:!1},this._candidates.set(_e(e),t),t)}};const{EventEmitter:_h}=ge.exports,gh=G,it=me,mh=Us,De=j.exports("discovery-swarm-webrtc"),yh=ph,{toHex:Gt,callbackPromise:vs,resolveCallback:ws}=gs,Es=er,{ERR_CONNECTION_DUPLICATED:bh}=Es,vh=n=>it(Buffer.isBuffer(n)&&n.length===32,"Channel must be a buffer of 32 bytes");class wh extends _h{constructor(e={}){super();De("opts",e);const{id:t=gh.randomBytes(32),bootstrap:r,stream:i,simplePeer:s,maxPeers:o=5,timeout:c=15*1e3,signal:a,mmst:u={}}=e;it(Array.isArray(r)&&r.length>0,"The `bootstrap` options is required."),it(Buffer.isBuffer(t)&&t.length===32,"The `id` option needs to be a Buffer of 32 bytes."),this.id=t;const l=c*2,h={id:this.id,bootstrap:r,createConnection:f=>this._createConnection(f),requestTimeout:c,simplePeer:s,reconnectingWebsocket:{connectionTimeout:c}};this.signal=a?a(h,this):new yh(q(R({},h),{mmstOpts:R({maxPeers:o,queueTimeout:l,lookupTimeout:c},u)})),this._maxPeers=o,this._stream=i,this._destroyed=!1,this._initialize(e)}get connected(){return this.signal.peersConnected}get connecting(){return this.signal.peersConnecting}listen(){}getPeers(e){return e?this.signal.getPeersByTopic(e).filter(t=>t.connected):this.signal.peersConnected}join(e){this.signal.join(e)}leave(e,t=vs()){return vh(e),ws(this.signal.leave(e),t),t.promise}close(e=vs()){return ws(this._close(),e),e.promise}async connect(e,t){it(e&&Buffer.isBuffer(e),"channel must be a buffer"),it(t&&Buffer.isBuffer(t),"peerId must be a buffer");const r=this.signal.connect(e,t);return r.subscribeMediaStream=!0,await r.ready(),r.stream}async _close(){this._destroyed||(this._destroyed=!0,await this.signal.close(),this.emit("close"))}_initialize(){const e=this.signal;this.on("error",(...t)=>De("error",...t)),e.on("peer-error",t=>this.emit("error",t)),e.on("error",t=>this.emit("error",t)),e.open().catch(t=>process.nextTick(()=>this.emit("error",t))),e.on("candidates-updated",(...t)=>this.emit("candidates-updated",...t))}_createConnection(e){e.subscribeMediaStream=!0,e.channel=e.topic,e.getInfo=()=>({id:e.id,channel:e.topic,initiator:e.initiator}),e.printInfo=()=>({id:Gt(e.id),channel:Gt(e.topic),initiator:e.initiator}),De("createConnection",{info:e.printInfo()});try{const t=this._checkForDuplicate(e);if(t){if(t===e)throw new bh(Gt(this.id),Gt(e.id));t.destroy()}return this._bindSocketEvents(e),e}catch(t){throw this.emit("connect-failed",t,e.getInfo()),t}}_bindSocketEvents(e){const t=e.getInfo();e.on("error",r=>{De("error",r),this.emit("connection-error",r,t)}),e.on("connect",()=>{if(De("connect",{peer:e}),e.stream.destroyed)return;if(!this._stream){this._handleConnection(e.stream,t);return}const r=this._stream(t);if(!r){this._handleConnection(e.stream,t);return}this.emit("handshaking",r,t),r.on("handshake",this._handshake.bind(this,r,t)),mh(e.stream,r,e.stream)}),e.on("close",()=>{De("close",{peer:e}),this.emit("connection-closed",e.stream,t)})}_handshake(e,t){this._handleConnection(e,t)}_handleConnection(e,t){this.emit("connection",e,t)}_checkForDuplicate(e){const t=this.signal.getPeersByTopic(e.channel).find(s=>s.id.equals(e.id)&&!s.sessionId.equals(e.sessionId));if(!t)return;const r=[e,t];if(e.initiator&&t.initiator||!e.initiator&&!t.initiator)return r.sort((s,o)=>Buffer.compare(s.sessionId,o.sessionId))[0];const i=[this.id,e.id].sort(Buffer.compare)[0];return r.find(s=>s.id.equals(i))}}ot.exports=(...n)=>new wh(...n);var Eh=ot.exports.errors=Es,Sh=ot.exports,Mh=Object.freeze(Os({__proto__:null,[Symbol.toStringTag]:"Module",default:Sh,errors:Eh},[ot.exports]));export{Mh as i};
